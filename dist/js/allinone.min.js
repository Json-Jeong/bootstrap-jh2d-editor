/*jslint jquery: true*/

/*
 * jQuery Hotkeys Plugin
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Based upon the plugin by Tzury Bar Yochay:
 * http://github.com/tzuryby/hotkeys
 *
 * Original idea by:
 * Binny V A, http://www.openjs.com/scripts/events/keyboard_shortcuts/
 */

/*
 * One small change is: now keys are passed by object { keys: '...' }
 * Might be useful, when you want to pass some other data to your handler
 */

(function(jQuery) {

  jQuery.hotkeys = {
    version: "0.8",

    specialKeys: {
      8: "backspace",
      9: "tab",
      10: "return",
      13: "return",
      16: "shift",
      17: "ctrl",
      18: "alt",
      19: "pause",
      20: "capslock",
      27: "esc",
      32: "space",
      33: "pageup",
      34: "pagedown",
      35: "end",
      36: "home",
      37: "left",
      38: "up",
      39: "right",
      40: "down",
      45: "insert",
      46: "del",
      59: ";",
      61: "=",
      96: "0",
      97: "1",
      98: "2",
      99: "3",
      100: "4",
      101: "5",
      102: "6",
      103: "7",
      104: "8",
      105: "9",
      106: "*",
      107: "+",
      109: "-",
      110: ".",
      111: "/",
      112: "f1",
      113: "f2",
      114: "f3",
      115: "f4",
      116: "f5",
      117: "f6",
      118: "f7",
      119: "f8",
      120: "f9",
      121: "f10",
      122: "f11",
      123: "f12",
      144: "numlock",
      145: "scroll",
      173: "-",
      186: ";",
      187: "=",
      188: ",",
      189: "-",
      190: ".",
      191: "/",
      192: "`",
      219: "[",
      220: "\\",
      221: "]",
      222: "'"
    },

    shiftNums: {
      "`": "~",
      "1": "!",
      "2": "@",
      "3": "#",
      "4": "$",
      "5": "%",
      "6": "^",
      "7": "&",
      "8": "*",
      "9": "(",
      "0": ")",
      "-": "_",
      "=": "+",
      ";": ": ",
      "'": "\"",
      ",": "<",
      ".": ">",
      "/": "?",
      "\\": "|"
    },

    // excludes: button, checkbox, file, hidden, image, password, radio, reset, search, submit, url
    textAcceptingInputTypes: [
      "text", "password", "number", "email", "url", "range", "date", "month", "week", "time", "datetime",
      "datetime-local", "search", "color", "tel"],

    options: {
      filterTextInputs: true
    }
  };

  function keyHandler(handleObj) {
    if (typeof handleObj.data === "string") {
      handleObj.data = {
        keys: handleObj.data
      };
    }

    // Only care when a possible input has been specified
    if (!handleObj.data || !handleObj.data.keys || typeof handleObj.data.keys !== "string") {
      return;
    }

    var origHandler = handleObj.handler,
      keys = handleObj.data.keys.toLowerCase().split(" ");

    handleObj.handler = function(event) {
      //      Don't fire in text-accepting inputs that we didn't directly bind to
      if (this !== event.target && (/textarea|select/i.test(event.target.nodeName) ||
          (jQuery.hotkeys.options.filterTextInputs &&
            jQuery.inArray(event.target.type, jQuery.hotkeys.textAcceptingInputTypes) > -1))) {
        return;
      }

      var special = event.type !== "keypress" && jQuery.hotkeys.specialKeys[event.which],
        character = String.fromCharCode(event.which).toLowerCase(),
        modif = "",
        possible = {};

      jQuery.each(["alt", "ctrl", "shift"], function(index, specialKey) {

        if (event[specialKey + 'Key'] && special !== specialKey) {
          modif += specialKey + '+';
        }
      });

      // metaKey is triggered off ctrlKey erronously
      if (event.metaKey && !event.ctrlKey && special !== "meta") {
        modif += "meta+";
      }

      if (event.metaKey && special !== "meta" && modif.indexOf("alt+ctrl+shift+") > -1) {
        modif = modif.replace("alt+ctrl+shift+", "hyper+");
      }

      if (special) {
        possible[modif + special] = true;
      }
      else {
        possible[modif + character] = true;
        possible[modif + jQuery.hotkeys.shiftNums[character]] = true;

        // "$" can be triggered as "Shift+4" or "Shift+$" or just "$"
        if (modif === "shift+") {
          possible[jQuery.hotkeys.shiftNums[character]] = true;
        }
      }

      for (var i = 0, l = keys.length; i < l; i++) {
        if (possible[keys[i]]) {
          return origHandler.apply(this, arguments);
        }
      }
    };
  }

  jQuery.each(["keydown", "keyup", "keypress"], function() {
    jQuery.event.special[this] = {
      add: keyHandler
    };
  });

})(jQuery || this.jQuery || window.jQuery);
//     uuid.js
//
//     Copyright (c) 2010-2012 Robert Kieffer
//     MIT License - http://opensource.org/licenses/mit-license.php

(function() {
  var _global = this;

  // Unique ID creation requires a high quality random # generator.  We feature
  // detect to determine the best RNG source, normalizing to a function that
  // returns 128-bits of randomness, since that's what's usually required
  var _rng;

  // Node.js crypto-based RNG - http://nodejs.org/docs/v0.6.2/api/crypto.html
  //
  // Moderately fast, high quality
  if (typeof(_global.require) == 'function') {
    try {
      var _rb = _global.require('crypto').randomBytes;
      _rng = _rb && function() {return _rb(16);};
    } catch(e) {}
  }

  if (!_rng && _global.crypto && crypto.getRandomValues) {
    // WHATWG crypto-based RNG - http://wiki.whatwg.org/wiki/Crypto
    //
    // Moderately fast, high quality
    var _rnds8 = new Uint8Array(16);
    _rng = function whatwgRNG() {
      crypto.getRandomValues(_rnds8);
      return _rnds8;
    };
  }

  if (!_rng) {
    // Math.random()-based (RNG)
    //
    // If all else fails, use Math.random().  It's fast, but is of unspecified
    // quality.
    var  _rnds = new Array(16);
    _rng = function() {
      for (var i = 0, r; i < 16; i++) {
        if ((i & 0x03) === 0) r = Math.random() * 0x100000000;
        _rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;
      }

      return _rnds;
    };
  }

  // Buffer class to use
  var BufferClass = typeof(_global.Buffer) == 'function' ? _global.Buffer : Array;

  // Maps for number <-> hex string conversion
  var _byteToHex = [];
  var _hexToByte = {};
  for (var i = 0; i < 256; i++) {
    _byteToHex[i] = (i + 0x100).toString(16).substr(1);
    _hexToByte[_byteToHex[i]] = i;
  }

  // **`parse()` - Parse a UUID into it's component bytes**
  function parse(s, buf, offset) {
    var i = (buf && offset) || 0, ii = 0;

    buf = buf || [];
    s.toLowerCase().replace(/[0-9a-f]{2}/g, function(oct) {
      if (ii < 16) { // Don't overflow!
        buf[i + ii++] = _hexToByte[oct];
      }
    });

    // Zero out remaining bytes if string was short
    while (ii < 16) {
      buf[i + ii++] = 0;
    }

    return buf;
  }

  // **`unparse()` - Convert UUID byte array (ala parse()) into a string**
  function unparse(buf, offset) {
    var i = offset || 0, bth = _byteToHex;
    return  bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]];
  }

  // **`v1()` - Generate time-based UUID**
  //
  // Inspired by https://github.com/LiosK/UUID.js
  // and http://docs.python.org/library/uuid.html

  // random #'s we need to init node and clockseq
  var _seedBytes = _rng();

  // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)
  var _nodeId = [
    _seedBytes[0] | 0x01,
    _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]
  ];

  // Per 4.2.2, randomize (14 bit) clockseq
  var _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;

  // Previous uuid creation time
  var _lastMSecs = 0, _lastNSecs = 0;

  // See https://github.com/broofa/node-uuid for API details
  function v1(options, buf, offset) {
    var i = buf && offset || 0;
    var b = buf || [];

    options = options || {};

    var clockseq = options.clockseq != null ? options.clockseq : _clockseq;

    // UUID timestamps are 100 nano-second units since the Gregorian epoch,
    // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so
    // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'
    // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.
    var msecs = options.msecs != null ? options.msecs : new Date().getTime();

    // Per 4.2.1.2, use count of uuid's generated during the current clock
    // cycle to simulate higher resolution clock
    var nsecs = options.nsecs != null ? options.nsecs : _lastNSecs + 1;

    // Time since last uuid creation (in msecs)
    var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;

    // Per 4.2.1.2, Bump clockseq on clock regression
    if (dt < 0 && options.clockseq == null) {
      clockseq = clockseq + 1 & 0x3fff;
    }

    // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new
    // time interval
    if ((dt < 0 || msecs > _lastMSecs) && options.nsecs == null) {
      nsecs = 0;
    }

    // Per 4.2.1.2 Throw error if too many uuids are requested
    if (nsecs >= 10000) {
      throw new Error('uuid.v1(): Can\'t create more than 10M uuids/sec');
    }

    _lastMSecs = msecs;
    _lastNSecs = nsecs;
    _clockseq = clockseq;

    // Per 4.1.4 - Convert from unix epoch to Gregorian epoch
    msecs += 12219292800000;

    // `time_low`
    var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
    b[i++] = tl >>> 24 & 0xff;
    b[i++] = tl >>> 16 & 0xff;
    b[i++] = tl >>> 8 & 0xff;
    b[i++] = tl & 0xff;

    // `time_mid`
    var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;
    b[i++] = tmh >>> 8 & 0xff;
    b[i++] = tmh & 0xff;

    // `time_high_and_version`
    b[i++] = tmh >>> 24 & 0xf | 0x10; // include version
    b[i++] = tmh >>> 16 & 0xff;

    // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)
    b[i++] = clockseq >>> 8 | 0x80;

    // `clock_seq_low`
    b[i++] = clockseq & 0xff;

    // `node`
    var node = options.node || _nodeId;
    for (var n = 0; n < 6; n++) {
      b[i + n] = node[n];
    }

    return buf ? buf : unparse(b);
  }

  // **`v4()` - Generate random UUID**

  // See https://github.com/broofa/node-uuid for API details
  function v4(options, buf, offset) {
    // Deprecated - 'format' argument, as supported in v1.2
    var i = buf && offset || 0;

    if (typeof(options) == 'string') {
      buf = options == 'binary' ? new BufferClass(16) : null;
      options = null;
    }
    options = options || {};

    var rnds = options.random || (options.rng || _rng)();

    // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
    rnds[6] = (rnds[6] & 0x0f) | 0x40;
    rnds[8] = (rnds[8] & 0x3f) | 0x80;

    // Copy bytes to buffer, if provided
    if (buf) {
      for (var ii = 0; ii < 16; ii++) {
        buf[i + ii] = rnds[ii];
      }
    }

    return buf || unparse(rnds);
  }

  // Export public API
  var uuid = v4;
  uuid.v1 = v1;
  uuid.v4 = v4;
  uuid.parse = parse;
  uuid.unparse = unparse;
  uuid.BufferClass = BufferClass;

  if (typeof(module) != 'undefined' && module.exports) {
    // Publish as node.js module
    module.exports = uuid;
  } else  if (typeof define === 'function' && define.amd) {
    // Publish as AMD module
    define(function() {return uuid;});
 

  } else {
    // Publish as global (in browsers)
    var _previousRoot = _global.uuid;

    // **`noConflict()` - (browser only) to reset global 'uuid' var**
    uuid.noConflict = function() {
      _global.uuid = _previousRoot;
      return uuid;
    };

    _global.uuid = uuid;
  }
}).call(this);
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.colorpicker&&a(window.jQuery)}(function(a){"use strict";var b=function(a){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,a&&(void 0!==a.toLowerCase?(a+="",this.setColor(a)):void 0!==a.h&&(this.value=a))};b.prototype={constructor:b,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(a){return"number"==typeof a?a:isNaN(a)||null===a||""===a||void 0===a?1:void 0!==a.toLowerCase?parseFloat(a):1},isTransparent:function(a){return a?(a=a.toLowerCase().trim(),"transparent"==a||a.match(/#?00000000/)||a.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(a){return 0==a.r&&0==a.g&&0==a.b&&0==a.a},setColor:function(a){a=a.toLowerCase().trim(),a&&(this.value=this.isTransparent(a)?{h:0,s:0,b:0,a:0}:this.stringToHSB(a)||{h:0,s:0,b:0,a:1})},stringToHSB:function(b){b=b.toLowerCase();var c=this,d=!1;return a.each(this.stringParsers,function(a,e){var f=e.re.exec(b),g=f&&e.parse.apply(c,[f]),h=e.format||"rgba";return g?(d=h.match(/hsla?/)?c.RGBtoHSB.apply(c,c.HSLtoRGB.apply(c,g)):c.RGBtoHSB.apply(c,g),c.origFormat=h,!1):!0}),d},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setBrightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return this.rgbaIsTransparent(e)?"transparent":"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)},toHSL:function(a,b,c,d){a=a||this.value.h,b=b||this.value.s,c=c||this.value.b,d=d||this.value.a;var e=a,f=(2-b)*c,g=b*c;return g/=f>0&&1>=f?f:2-f,f/=2,g>1&&(g=1),{h:isNaN(e)?0:e,s:isNaN(g)?0:g,l:isNaN(f)?0:f,a:isNaN(d)?0:d}},toAlias:function(a,b,c,d){var e=this.toHex(a,b,c,d);for(var f in this.colors)if(this.colors[f]==e)return f;return!1},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g===a?(b-c)/h:g===b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:this._sanitizeNumber(e),s:f,b:g,a:this._sanitizeNumber(d)}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},HSLtoRGB:function(a,b,c,d){0>b&&(b=0);var e;e=.5>=c?c*(1+b):c+b-c*b;var f=2*c-e,g=a+1/3,h=a,i=a-1/3,j=Math.round(255*this.HueToRGB(f,e,g)),k=Math.round(255*this.HueToRGB(f,e,h)),l=Math.round(255*this.HueToRGB(f,e,i));return[j,k,l,this._sanitizeNumber(d)]},toString:function(a){switch(a=a||"rgba"){case"rgb":var b=this.toRGB();return this.rgbaIsTransparent(b)?"transparent":"rgb("+b.r+","+b.g+","+b.b+")";case"rgba":var b=this.toRGB();return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";case"hsl":var c=this.toHSL();return"hsl("+Math.round(360*c.h)+","+Math.round(100*c.s)+"%,"+Math.round(100*c.l)+"%)";case"hsla":var c=this.toHSL();return"hsla("+Math.round(360*c.h)+","+Math.round(100*c.s)+"%,"+Math.round(100*c.l)+"%,"+c.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return!1}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(a){return[a[1],a[2],a[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}},{re:/^([a-z]{3,})$/,format:"alias",parse:function(a){var b=this.colorNameToHex(a[0])||"#000000",c=this.stringParsers[6].re.exec(b),d=c&&this.stringParsers[6].parse.apply(this,[c]);return d}}],colorNameToHex:function(a){return"undefined"!=typeof this.colors[a.toLowerCase()]?this.colors[a.toLowerCase()]:!1}};var c={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'},d=function(d,e){this.element=a(d).addClass("colorpicker-element"),this.options=a.extend({},c,this.element.data(),e),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new b(this.options.color!==!1?this.options.color:this.getValue()),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=a(this.options.template),this.picker.addClass(this.options.inline?"colorpicker-inline colorpicker-visible":"colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.picker.on("mousedown.colorpicker touchstart.colorpicker",a.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:a("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":a.proxy(this.keyup,this)}),this.component===!1&&this.element.on({"focus.colorpicker":a.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":a.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":a.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":a.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":a.proxy(this.show,this),"focus.colorpicker":a.proxy(this.show,this)}),this.update(),a(a.proxy(function(){this.element.trigger("create")},this))};d.Color=b,d.prototype={constructor:d,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var a=this.container&&this.container[0]!==document.body?"position":"offset",b=this.component||this.element,c=b[a]();"right"===this.options.align&&(c.left-=this.picker.outerWidth()-b.outerWidth()),this.picker.css({top:c.top+b.outerHeight(),left:c.left})},show:function(b){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),a(window).on("resize.colorpicker",a.proxy(this.reposition,this)),!b||this.hasInput()&&"color"!==this.input.attr("type")||b.stopPropagation&&b.preventDefault&&(b.stopPropagation(),b.preventDefault()),this.options.inline===!1&&a(window.document).on({"mousedown.colorpicker":a.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),a(window).off("resize.colorpicker",this.reposition),a(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){return a=a||this.color.toString(this.format),this.element.data("color",a),a},updateInput:function(a){return a=a||this.color.toString(this.format),this.input!==!1&&this.input.prop("value",a),a},updatePicker:function(a){void 0!==a&&(this.color=new b(a));var c=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,d=this.picker.find("i");return 0!==d.length?(this.options.horizontal===!1?(c=this.options.sliders,d.eq(1).css("top",c.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",c.alpha.maxTop*(1-this.color.value.a))):(c=this.options.slidersHorz,d.eq(1).css("left",c.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",c.alpha.maxLeft*(1-this.color.value.a))),d.eq(0).css({top:c.saturation.maxTop-this.color.value.b*c.saturation.maxTop,left:this.color.value.s*c.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),a):void 0},updateComponent:function(a){if(a=a||this.color.toString(this.format),this.component!==!1){var b=this.component.find("i").eq(0);b.length>0?b.css({backgroundColor:a}):this.component.css({backgroundColor:a})}return a},update:function(a){var b;return(this.getValue(!1)!==!1||a===!0)&&(b=this.updateComponent(),this.updateInput(b),this.updateData(b),this.updatePicker()),b},setValue:function(a){this.color=new b(a),this.update(),this.element.trigger({type:"changeColor",color:this.color,value:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("color"),(void 0===b||""===b||null===b)&&(b=a),b},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(b){b.pageX||b.pageY||!b.originalEvent||(b.pageX=b.originalEvent.touches[0].pageX,b.pageY=b.originalEvent.touches[0].pageY),b.stopPropagation(),b.preventDefault();var c=a(b.target),d=c.closest("div"),e=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!d.is(".colorpicker")){if(d.is(".colorpicker-saturation"))this.currentSlider=a.extend({},e.saturation);else if(d.is(".colorpicker-hue"))this.currentSlider=a.extend({},e.hue);else{if(!d.is(".colorpicker-alpha"))return!1;this.currentSlider=a.extend({},e.alpha)}var f=d.offset();this.currentSlider.guide=d.find("i")[0].style,this.currentSlider.left=b.pageX-f.left,this.currentSlider.top=b.pageY-f.top,this.mousePointer={left:b.pageX,top:b.pageY},a(document).on({"mousemove.colorpicker":a.proxy(this.mousemove,this),"touchmove.colorpicker":a.proxy(this.mousemove,this),"mouseup.colorpicker":a.proxy(this.mouseup,this),"touchend.colorpicker":a.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(a){a.pageX||a.pageY||!a.originalEvent||(a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY),a.stopPropagation(),a.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((a.pageX||this.mousePointer.left)-this.mousePointer.left))),c=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((a.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=b+"px",this.currentSlider.guide.top=c+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,c/this.currentSlider.maxTop),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(b){return b.stopPropagation(),b.preventDefault(),a(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},keyup:function(a){if(38===a.keyCode)this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0);else if(40===a.keyCode)this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0);else{var c=this.input.val();this.color=new b(c),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())}this.element.trigger({type:"changeColor",color:this.color,value:c})}},a.colorpicker=d,a.fn.colorpicker=function(b){var c,e=arguments,f=this.each(function(){var f=a(this),g=f.data("colorpicker"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(c=g[b].apply(g,Array.prototype.slice.call(e,1))):f.data("colorpicker",new d(this,h))});return"getValue"===b?c:f},a.fn.colorpicker.constructor=d});/*! =======================================================
                      VERSION  4.8.1              
========================================================= */
/*! =========================================================
 * bootstrap-slider.js
 *
 * Maintainers:
 *		Kyle Kemp
 *			- Twitter: @seiyria
 *			- Github:  seiyria
 *		Rohit Kalkur
 *			- Twitter: @Rovolutionary
 *			- Github:  rovolution
 *
 * =========================================================
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
!function(a,b){if("function"==typeof define&&define.amd)define(["jquery"],b);else if("object"==typeof module&&module.exports){var c;try{c=require("jquery")}catch(d){c=null}module.exports=b(c)}else a.Slider=b(a.jQuery)}(this,function(a){var b;return function(a){"use strict";function b(){}function c(a){function c(b){b.prototype.option||(b.prototype.option=function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))})}function e(b,c){a.fn[b]=function(e){if("string"==typeof e){for(var g=d.call(arguments,1),h=0,i=this.length;i>h;h++){var j=this[h],k=a.data(j,b);if(k)if(a.isFunction(k[e])&&"_"!==e.charAt(0)){var l=k[e].apply(k,g);if(void 0!==l&&l!==k)return l}else f("no such method '"+e+"' for "+b+" instance");else f("cannot call methods on "+b+" prior to initialization; attempted to call '"+e+"'")}return this}var m=this.map(function(){var d=a.data(this,b);return d?(d.option(e),d._init()):(d=new c(this,e),a.data(this,b,d)),a(this)});return!m||m.length>1?m:m[0]}}if(a){var f="undefined"==typeof console?b:function(a){console.error(a)};return a.bridget=function(a,b){c(b),e(a,b)},a.bridget}}var d=Array.prototype.slice;c(a)}(a),function(a){function c(b,c){function d(a,b){var c="data-slider-"+b.replace(/_/g,"-"),d=a.getAttribute(c);try{return JSON.parse(d)}catch(e){return d}}"string"==typeof b?this.element=document.querySelector(b):b instanceof HTMLElement&&(this.element=b),c=c?c:{};for(var f=Object.keys(this.defaultOptions),g=0;g<f.length;g++){var h=f[g],i=c[h];i="undefined"!=typeof i?i:d(this.element,h),i=null!==i?i:this.defaultOptions[h],this.options||(this.options={}),this.options[h]=i}var j,k,l,m,n,o=this.element.style.width,p=!1,q=this.element.parentNode;if(this.sliderElem)p=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var r=document.createElement("div");if(r.className="slider-track",k=document.createElement("div"),k.className="slider-track-low",j=document.createElement("div"),j.className="slider-selection",l=document.createElement("div"),l.className="slider-track-high",m=document.createElement("div"),m.className="slider-handle min-slider-handle",n=document.createElement("div"),n.className="slider-handle max-slider-handle",r.appendChild(k),r.appendChild(j),r.appendChild(l),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(g=0;g<this.options.ticks.length;g++){var s=document.createElement("div");s.className="slider-tick",this.ticks.push(s),r.appendChild(s)}j.className+=" tick-slider-selection"}if(r.appendChild(m),r.appendChild(n),this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",g=0;g<this.options.ticks_labels.length;g++){var t=document.createElement("div");t.className="slider-tick-label",t.innerHTML=this.options.ticks_labels[g],this.tickLabels.push(t),this.tickLabelContainer.appendChild(t)}var u=function(a){var b=document.createElement("div");b.className="tooltip-arrow";var c=document.createElement("div");c.className="tooltip-inner",a.appendChild(b),a.appendChild(c)},v=document.createElement("div");v.className="tooltip tooltip-main",u(v);var w=document.createElement("div");w.className="tooltip tooltip-min",u(w);var x=document.createElement("div");x.className="tooltip tooltip-max",u(x),this.sliderElem.appendChild(r),this.sliderElem.appendChild(v),this.sliderElem.appendChild(w),this.sliderElem.appendChild(x),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),q.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(a&&(this.$element=a(this.element),this.$sliderElem=a(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),e[this.options.scale]&&(this.options.scale=e[this.options.scale]),p===!0&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","top","width","height"].forEach(function(a){this._removeProperty(this.trackLow,a),this._removeProperty(this.trackSelection,a),this._removeProperty(this.trackHigh,a)},this),[this.handle1,this.handle2].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top")},this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top"),this._removeProperty(a,"margin-left"),this._removeProperty(a,"margin-top"),this._removeClass(a,"right"),this._removeClass(a,"top")},this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this._addClass(this.tooltip,"right"),this.tooltip.style.left="100%",this._addClass(this.tooltip_min,"right"),this.tooltip_min.style.left="100%",this._addClass(this.tooltip_max,"right"),this.tooltip_max.style.left="100%"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=o,this.options.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this._addClass(this.tooltip,"top"),this.tooltip.style.top=-this.tooltip.outerHeight-14+"px",this._addClass(this.tooltip_min,"top"),this.tooltip_min.style.top=-this.tooltip_min.outerHeight-14+"px",this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=-this.tooltip_max.outerHeight-14+"px"),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?this.options.range=!0:this.options.range&&(this.options.value=[this.options.value,this.options.max]),this.trackLow=k||this.trackLow,this.trackSelection=j||this.trackSelection,this.trackHigh=l||this.trackHigh,"none"===this.options.selection&&(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")),this.handle1=m||this.handle1,this.handle2=n||this.handle2,p===!0)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),g=0;g<this.ticks.length;g++)this._removeClass(this.ticks[g],"round triangle hide");var y=["round","triangle","custom"],z=-1!==y.indexOf(this.options.handle);if(z)for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),g=0;g<this.ticks.length;g++)this._addClass(this.ticks[g],this.options.handle);this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos],this.setValue(this.options.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchCapable&&this.sliderElem.addEventListener("touchstart",this.mousedown,!1),this.sliderElem.addEventListener("mousedown",this.mousedown,!1),"hide"===this.options.tooltip?(this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide")):"always"===this.options.tooltip?(this._showTooltip(),this._alwaysShowTooltip=!0):(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1),this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)),this.options.enabled?this.enable():this.disable()}var d={formatInvalidInputErrorMsg:function(a){return"Invalid input value '"+a+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"},e={linear:{toValue:function(a){var b=a/100*(this.options.max-this.options.min);if(this.options.ticks_positions.length>0){for(var c,d,e,f=0,g=0;g<this.options.ticks_positions.length;g++)if(a<=this.options.ticks_positions[g]){c=g>0?this.options.ticks[g-1]:0,e=g>0?this.options.ticks_positions[g-1]:0,d=this.options.ticks[g],f=this.options.ticks_positions[g];break}if(g>0){var h=(a-e)/(f-e);b=c+h*(d-c)}}var i=this.options.min+Math.round(b/this.options.step)*this.options.step;return i<this.options.min?this.options.min:i>this.options.max?this.options.max:i},toPercentage:function(a){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var b,c,d,e=0,f=0;f<this.options.ticks.length;f++)if(a<=this.options.ticks[f]){b=f>0?this.options.ticks[f-1]:0,d=f>0?this.options.ticks_positions[f-1]:0,c=this.options.ticks[f],e=this.options.ticks_positions[f];break}if(f>0){var g=(a-b)/(c-b);return d+g*(e-d)}}return 100*(a-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(a){var b=0===this.options.min?0:Math.log(this.options.min),c=Math.log(this.options.max),d=Math.exp(b+(c-b)*a/100);return d=this.options.min+Math.round((d-this.options.min)/this.options.step)*this.options.step,d<this.options.min?this.options.min:d>this.options.max?this.options.max:d},toPercentage:function(a){if(this.options.max===this.options.min)return 0;var b=Math.log(this.options.max),c=0===this.options.min?0:Math.log(this.options.min),d=0===a?0:Math.log(a);return 100*(d-c)/(b-c)}}};if(b=function(a,b){return c.call(this,a,b),this},b.prototype={_init:function(){},constructor:b,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,enabled:!0,formatter:function(a){return Array.isArray(a)?a[0]+" : "+a[1]:a},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,scale:"linear",focus:!1},over:!1,inDrag:!1,getValue:function(){return this.options.range?this.options.value:this.options.value[0]},setValue:function(a,b,c){a||(a=0);var d=this.getValue();this.options.value=this._validateInputValue(a);var e=this._applyPrecision.bind(this);this.options.range?(this.options.value[0]=e(this.options.value[0]),this.options.value[1]=e(this.options.value[1]),this.options.value[0]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[0])),this.options.value[1]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[1]))):(this.options.value=e(this.options.value),this.options.value=[Math.max(this.options.min,Math.min(this.options.max,this.options.value))],this._addClass(this.handle2,"hide"),this.options.value[1]="after"===this.options.selection?this.options.max:this.options.min),this.percentage=this.options.max>this.options.min?[this._toPercentage(this.options.value[0]),this._toPercentage(this.options.value[1]),100*this.options.step/(this.options.max-this.options.min)]:[0,0,100],this._layout();var f=this.options.range?this.options.value:this.options.value[0];return b===!0&&this._trigger("slide",f),d!==f&&c===!0&&this._trigger("change",{oldValue:d,newValue:f}),this._setDataVal(f),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),a&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this.options.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this.options.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this.options.enabled?this.disable():this.enable(),this},isEnabled:function(){return this.options.enabled},on:function(a,b){return this._bindNonQueryEventHandler(a,b),this},getAttribute:function(a){return a?this.options[a]:this.options},setAttribute:function(a,b){return this.options[a]=b,this},refresh:function(){return this._removeSliderEventHandlers(),c.call(this,this.element,this.options),a&&a.data(this.element,"slider",this),this},relayout:function(){return this._layout(),this},_removeSliderEventHandlers:function(){this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.handle2.removeEventListener("focus",this.handle2Keydown,!1),this.handle2.removeEventListener("blur",this.handle2Keydown,!1),this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.mousedown,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1)},_bindNonQueryEventHandler:function(a,b){void 0===this.eventToCallbackMap[a]&&(this.eventToCallbackMap[a]=[]),this.eventToCallbackMap[a].push(b)},_cleanUpEventCallbacksMap:function(){for(var a=Object.keys(this.eventToCallbackMap),b=0;b<a.length;b++){var c=a[b];this.eventToCallbackMap[c]=null}},_showTooltip:function(){this.options.tooltip_split===!1?this._addClass(this.tooltip,"in"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in")),this.over=!0},_hideTooltip:function(){this.inDrag===!1&&this.alwaysShowTooltip!==!0&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this.over=!1},_layout:function(){var a;if(a=this.options.reversed?[100-this.percentage[0],this.percentage[1]]:[this.percentage[0],this.percentage[1]],this.handle1.style[this.stylePos]=a[0]+"%",this.handle2.style[this.stylePos]=a[1]+"%",Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var b=Math.max.apply(Math,this.options.ticks),c=Math.min.apply(Math,this.options.ticks),d="vertical"===this.options.orientation?"height":"width",e="vertical"===this.options.orientation?"marginTop":"marginLeft",f=this.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var g=0;if(0===this.options.ticks_positions.length)this.tickLabelContainer.style[e]=-f/2+"px",g=this.tickLabelContainer.offsetHeight;else for(h=0;h<this.tickLabelContainer.childNodes.length;h++)this.tickLabelContainer.childNodes[h].offsetHeight>g&&(g=this.tickLabelContainer.childNodes[h].offsetHeight);"horizontal"===this.options.orientation&&(this.sliderElem.style.marginBottom=g+"px")}for(var h=0;h<this.options.ticks.length;h++){var i=this.options.ticks_positions[h]||100*(this.options.ticks[h]-c)/(b-c);this.ticks[h].style[this.stylePos]=i+"%",this._removeClass(this.ticks[h],"in-selection"),this.options.range?i>=a[0]&&i<=a[1]&&this._addClass(this.ticks[h],"in-selection"):"after"===this.options.selection&&i>=a[0]?this._addClass(this.ticks[h],"in-selection"):"before"===this.options.selection&&i<=a[0]&&this._addClass(this.ticks[h],"in-selection"),this.tickLabels[h]&&(this.tickLabels[h].style[d]=f+"px",void 0!==this.options.ticks_positions[h]&&(this.tickLabels[h].style.position="absolute",this.tickLabels[h].style[this.stylePos]=this.options.ticks_positions[h]+"%",this.tickLabels[h].style[e]=-f/2+"px"))}}if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(a[0],a[1])+"%",this.trackSelection.style.top=Math.min(a[0],a[1])+"%",this.trackSelection.style.height=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";else{this.trackLow.style.left="0",this.trackLow.style.width=Math.min(a[0],a[1])+"%",this.trackSelection.style.left=Math.min(a[0],a[1])+"%",this.trackSelection.style.width=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";var j=this.tooltip_min.getBoundingClientRect(),k=this.tooltip_max.getBoundingClientRect();j.right>k.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}var l;if(this.options.range){l=this.options.formatter(this.options.value),this._setText(this.tooltipInner,l),this.tooltip.style[this.stylePos]=(a[1]+a[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px"),"vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");var m=this.options.formatter(this.options.value[0]);this._setText(this.tooltipInner_min,m);var n=this.options.formatter(this.options.value[1]);this._setText(this.tooltipInner_max,n),this.tooltip_min.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-top",-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-left",-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=a[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-top",-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-left",-this.tooltip_max.offsetWidth/2+"px")}else l=this.options.formatter(this.options.value[0]),this._setText(this.tooltipInner,l),this.tooltip.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px")},_removeProperty:function(a,b){a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(b)},_mousedown:function(a){if(!this.options.enabled)return!1;this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos];var b=this._getPercentage(a);if(this.options.range){var c=Math.abs(this.percentage[0]-b),d=Math.abs(this.percentage[1]-b);this.dragged=d>c?0:1}else this.dragged=0;this.percentage[this.dragged]=this.options.reversed?100-b:b,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this.inDrag=!0;var e=this._calculateValue();return this._trigger("slideStart",e),this._setDataVal(e),this.setValue(e,!1,!0),this._pauseEvent(a),this.options.focus&&this._triggerFocusOnHandle(this.dragged),!0},_triggerFocusOnHandle:function(a){0===a&&this.handle1.focus(),1===a&&this.handle2.focus()},_keydown:function(a,b){if(!this.options.enabled)return!1;var c;switch(b.keyCode){case 37:case 40:c=-1;break;case 39:case 38:c=1}if(c){if(this.options.natural_arrow_keys){var d="vertical"===this.options.orientation&&!this.options.reversed,e="horizontal"===this.options.orientation&&this.options.reversed;(d||e)&&(c=-c)}var f=this.options.value[a]+c*this.options.step;return this.options.range&&(f=[a?this.options.value[0]:f,a?f:this.options.value[1]]),this._trigger("slideStart",f),this._setDataVal(f),this.setValue(f,!0,!0),this._trigger("slideStop",f),this._setDataVal(f),this._layout(),this._pauseEvent(b),!1}},_pauseEvent:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1},_mousemove:function(a){if(!this.options.enabled)return!1;var b=this._getPercentage(a);this._adjustPercentageForRangeSliders(b),this.percentage[this.dragged]=this.options.reversed?100-b:b,this._layout();var c=this._calculateValue(!0);return this.setValue(c,!0,!0),!1},_adjustPercentageForRangeSliders:function(a){this.options.range&&(0===this.dragged&&this.percentage[1]<a?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>a&&(this.percentage[1]=this.percentage[0],this.dragged=0))},_mouseup:function(){if(!this.options.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this.inDrag=!1,this.over===!1&&this._hideTooltip();var a=this._calculateValue(!0);return this._layout(),this._trigger("slideStop",a),this._setDataVal(a),!1},_calculateValue:function(a){var b;if(this.options.range?(b=[this.options.min,this.options.max],0!==this.percentage[0]&&(b[0]=this._toValue(this.percentage[0]),b[0]=this._applyPrecision(b[0])),100!==this.percentage[1]&&(b[1]=this._toValue(this.percentage[1]),b[1]=this._applyPrecision(b[1]))):(b=this._toValue(this.percentage[0]),b=parseFloat(b),b=this._applyPrecision(b)),a){for(var c=[b,1/0],d=0;d<this.options.ticks.length;d++){var e=Math.abs(this.options.ticks[d]-b);e<=c[1]&&(c=[this.options.ticks[d],e])}if(c[1]<=this.options.ticks_snap_bounds)return c[0]}return b},_applyPrecision:function(a){var b=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(a,b)},_getNumDigitsAfterDecimalPlace:function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},_applyToFixedAndParseFloat:function(a,b){var c=a.toFixed(b);return parseFloat(c)},_getPercentage:function(a){!this.touchCapable||"touchstart"!==a.type&&"touchmove"!==a.type||(a=a.touches[0]);var b=a[this.mousePos],c=this.offset[this.stylePos],d=b-c,e=d/this.size*100;return e=Math.round(e/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,e))},_validateInputValue:function(a){if("number"==typeof a)return a;if(Array.isArray(a))return this._validateArray(a),a;throw new Error(d.formatInvalidInputErrorMsg(a))},_validateArray:function(a){for(var b=0;b<a.length;b++){var c=a[b];if("number"!=typeof c)throw new Error(d.formatInvalidInputErrorMsg(c))}},_setDataVal:function(a){var b="value: '"+a+"'";this.element.setAttribute("data",b),this.element.setAttribute("value",a),this.element.value=a},_trigger:function(b,c){c=c||0===c?c:void 0;var d=this.eventToCallbackMap[b];if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];f(c)}a&&this._triggerJQueryEvent(b,c)},_triggerJQueryEvent:function(a,b){var c={type:a,value:b};this.$element.trigger(c),this.$sliderElem.trigger(c)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(a,b){"undefined"!=typeof a.innerText?a.innerText=b:"undefined"!=typeof a.textContent&&(a.textContent=b)},_removeClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)");d=d.replace(g," ")}a.className=d.trim()},_addClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)"),h=g.test(d);h||(d+=" "+f)}a.className=d.trim()},_offsetLeft:function(a){for(var b=a.offsetLeft;(a=a.offsetParent)&&!isNaN(a.offsetLeft);)b+=a.offsetLeft;return b},_offsetTop:function(a){for(var b=a.offsetTop;(a=a.offsetParent)&&!isNaN(a.offsetTop);)b+=a.offsetTop;return b},_offset:function(a){return{left:this._offsetLeft(a),top:this._offsetTop(a)}},_css:function(b,c,d){if(a)a.style(b,c,d);else{var e=c.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(a,b){return b.toUpperCase()});b.style[e]=d}},_toValue:function(a){return this.options.scale.toValue.apply(this,[a])},_toPercentage:function(a){return this.options.scale.toPercentage.apply(this,[a])}},a){var f=a.fn.slider?"bootstrapSlider":"slider";a.bridget(f,b)}}(a),b});/*! jquery-imagerect 2015-04-29 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&a(window.jQuery)}(function(a){var b={},c=function(c,d){this.elm=a(c),this.option(a.extend({},b,this.elm.data(),d))};c.version="0.1.1",c.prototype={constructor:c,imageload:function(){this.elm.text(""),this.url(this.opts.url),this.opts.w=this.opts.w||this.elm.width(),this.opts.h=this.opts.h||this.elm.height(),this.opts.w<this.img.width&&(this.elm.css("background-size","100% auto"),this.elm.css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.opts.url+"', sizingMethod='scale')\\9")),this.percent=this.opts.w/this.img.width;var b=this.opts.rect||this.defRect(),c=this.img.height*this.percent;this.elm.height(Math.max(this.opts.h,c)),null==this.selector&&(this.selector=a('<div class="imagerect-selector"></div>').appendTo(this.elm),this.selector.on("dblclick",a.proxy(this.dblclick,this)),this.selector.on("mousedown",a.proxy(this.mousedown,this)),this.selector.on("mouseup",a.proxy(this.mouseup,this)),this.selector.css("resize",this.opts.resize||"both")),this.rect(b),this.elm.trigger({type:"load",value:this.rect(),relatedTarget:this.img})},defRect:function(){return{w:this.img.width/2,h:this.img.height/2,x:this.img.width/4,y:this.img.height/4}},url:function(a){return a&&this.elm.css({background:"url("+a+") no-repeat"}),this.opts.url},option:function(b){if(b){if(b.url){var c=new Image;c.src=b.url,a(c).on("load",a.proxy(this.imageload,this)),this.img=c,this.elm.text("loading...")}this.opts=a.extend(this.opts,b)}return this.opts},mousedown:function(b){b.stopPropagation();var c=b.originalEvent,d=this.selector.width(),e=this.selector.height();this.sw=d,this.sh=e,this.offsetDx=c.clientX-this.elm.offset().left,this.offsetDy=c.clientY-this.elm.offset().top,this.selector.on("mousemove",a.proxy(this.mousemove,this))},mousemove:function(a){a.stopPropagation();var b=a.originalEvent,c=this.selector.width(),d=this.selector.height();this.sw===c&&this.sh===d&&(this.offsetMx=b.clientX-this.elm.offset().left,this.offsetMy=b.clientY-this.elm.offset().top,this.move(),this.offsetDx=this.offsetMx,this.offsetDy=this.offsetMy)},mouseup:function(){this.selector.off("mousemove");var b=this.percent,c=this.currOffset(),d=this.selector.innerWidth(),e=this.selector.innerHeight();a.extend(this.opts.rect,{x:c.left/b,y:c.top/b,w:d/b,h:e/b}),this.elm.trigger({type:"pick",value:this.rect()})},move:function(){var a=this.offsetMx-this.offsetDx,b=this.offsetMy-this.offsetDy,c=this.selector.offset(),d=c.left,e=c.top;this.selector.offset({top:e+b,left:d+a})},dblclick:function(a){if(a.stopPropagation(),a.preventDefault(),this.opts.dblToggle){this.opts.dblToggle=!1;var b=this.lastRect||this.defRect();console.log(b),this.elm.trigger({type:"pick",value:this.rect({x:b.x,y:b.y,w:b.w,h:b.h})})}else this.opts.dblToggle=!0,this.lastRect=this.rect(),this.elm.trigger({type:"pick",value:this.rect({x:0,y:0,w:this.img.width,h:this.img.height})})},currOffset:function(){var a=this.selector.offset(),b=this.elm.offset(),c=(this.selector.outerWidth(!0)-this.selector.innerWidth())/2,d=(this.selector.outerHeight(!0)-this.selector.innerHeight())/2,e=a.left-b.left+c,f=a.top-b.top+d;return{left:e,top:f}},rect:function(b){var c=this.percent;if(b){b=a.extend({},this.opts.rect,b);var d=b.x*c,e=b.y*c,f=b.w*c,g=b.h*c,h=this.currOffset();this.offsetMx=d,this.offsetMy=e,this.offsetDx=h.left,this.offsetDy=h.top,this.move(),this.selector.width(f),this.selector.height(g),this.opts.rect=b}return this.opts.rect}},a.imagerect=c,a.fn.imagerect=function(b){var d=arguments,e=null;return this.each(function(){var f=a(this),g=f.data("imagerect"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(e=g[b].apply(g,Array.prototype.slice.call(d,1))):f.data("imagerect",new c(this,h))}),e||this},a.fn.imagerect.constructor=c});/*! bootstrap-colorpicker-plus 2015-04-30 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","bootstrap-colorpicker"],a):window.jQuery&&!window.jQuery.fn.colorpickerplus&&a(window.jQuery)}(function(a){var b=["#5B0F00","#660000","#783F04","#7F6000","#274E13","#0C343D","#1C4587","#073763","#20124D","#4C1130","#5B0F00","#660000","#783F04","#7F6000","#274E13","#0C343D","#1C4587","#073763","#20124D","#4C1130","#85200C","#990000","#B45F06","#BF9000","#38761D","#134F5C","#1155CC","#0B5394","#351C75","#741B47","#A61C00","#CC0000","#E69138","#F1C232","#6AA84F","#45818E","#3C78D8","#3D85C6","#674EA7","#A64D79","#CC4125","#E06666","#F6B26B","#FFD966","#93C47D","#76A5AF","#6D9EEB","#6FA8DC","#8E7CC3","#C27BA0","#DD7E6B","#EA9999","#F9CB9C","#FFE599","#B6D7A8","#A2C4C9","#A4C2F4","#9FC5E8","#B4A7D6","#D5A6BD","#E6B8AF","#F4CCCC","#FCE5CD","#FFF2CC","#D9EAD3","#D0E0E3","#C9DAF8","#CFE2F3","#D9D2E9","#EAD1DC","#980000","#FF0000","#FF9900","#FFFF00","#00FF00","#00FFFF","#4A86E8","#0000FF","#9900FF","#FF00FF"],c=window.localStorage,d=[];c&&(c.getItem("colorpickerplus_custom_colors")||c.setItem("colorpickerplus_custom_colors",d.join()),d=c.getItem("colorpickerplus_custom_colors").split(","));var e=8,f=10,g=function(b,c){return c||(c=a('<div class="colorcell"></div>')),b?(c.attr("data-color",b),c.css("background-color",b)):c.addClass("colorpicker-color"),c},h=function(c){for(var h=a(c),i=Math.max(Math.ceil(d.length/f),1),j=null,k=0;i>k;k++){j=a(k===i-1?'<div class="colorpickerplus-custom-colors"></div>':'<div class="colorpickerplus-colors-row"></div>');for(var l=0;f>l;l++){var m=k*f+l,n=null;if(m<d.length){var o=d[m];n=g(o)}else n=a('<div class="colorcell nohover"></div>');n.appendTo(j)}j.appendTo(h)}for(k=0;e>k;k++){j=null,j=a(e-1>k?'<div class="colorpickerplus-colors-row"></div>':'<div class="colorpickerplus-primary-colors"></div>');for(var p=0;f>p;p++){var q=b[k*f+p];g(q).appendTo(j)}j.appendTo(h)}var r=a('<div class="input-group input-group-sm"><input type="text" class="form-control" size="6"/><span class="input-group-btn"><button class="btn btn-default" type="button" title="Custom Color">C</button></span></div>'),s=a("input",r);r.appendTo(h),h.on("click.colorpickerplus-container",".colorcell",a.proxy(this.select,this)),r.on("click.colorpickerplus-container","button",a.proxy(this.custom,this)),s.on("changeColor.colorpickerplus-container",a.proxy(this.change,this)),h.on("mousedown mouseup click touchstart",a.proxy(this.stopPropagation,this)),this.element=h,s.colorpicker(),this.colorInput=s,s.data("colorpicker").picker.on("click touchstart",a.proxy(this.stopPropagation,this))};h.prototype={constructor:h,custom:function(){var b=this.colorInput.val();d[d.length]=b;var e=a(".colorcell.nohover",this.element),f=g(b,e.first());f.removeClass("nohover"),c.setItem("colorpickerplus_custom_colors",d.join())},select:function(b){var c=a(b.target).data("color");null==c?this.element.trigger({type:"changeColor",color:c}):this.update(c),this.element.trigger({type:"select",color:c}),this.colorInput.colorpicker("hide")},change:function(a){a.stopPropagation(),this.element.trigger({type:"changeColor",color:a.color.toHex()})},update:function(b){var c=a(".colorcell",this.element);c.removeClass("selected"),null!=b&&(this.colorInput.val(b),this.colorInput.colorpicker("setValue",b)),c.each(function(){var c=a(this).data("color");return null!=b&&c===b.toUpperCase()?(a(this).addClass("selected"),!1):void 0})},stopPropagation:function(b){a(b.target).is(".colorcell")||b.stopPropagation()}},a.colorpickerembed=h,a.fn.colorpickerembed=function(b){var c=arguments;return this.each(function(){var d=a(this),e=d.data("colorpickerembed"),f="object"==typeof b?b:{};e||"string"==typeof b?"string"==typeof b&&e[b].apply(e,Array.prototype.slice.call(c,1)):d.data("colorpickerembed",new h(this,f))})},a.fn.colorpickerembed.constructor=h;var i=a(".colorpickerplus");i.length<=0&&(i=a('<div class="colorpickerplus"></div>'),i.appendTo(a("body")));var j=a('<div class="colorpickerplus-container"></div>').appendTo(i);j.colorpickerembed();var k=null;j.on("select",function(){k&&m()}),j.on("changeColor",function(a){k&&k.setValue(a.color)}),i.on("mousedown mouseup click touchstart",function(a){a.stopPropagation()});var l=function(a){j.data("colorpickerembed").update(a.getValue()),k=a,i.show()},m=function(){i.hide(),k=null},n=function(a){var b=a.element.offset();b.top+=a.element.outerHeight(),i.css(b)},o={},p=function(b,c){this.element=a(b),this.options=a.extend({},o,this.element.data(),c),this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.input!==!1&&this.element.on({"focus.colorpickerplus":a.proxy(this.show,this)}),this.input===!1&&this.element.on({"click.colorpickerplus":a.proxy(this.show,this)})};p.version="0.1.0",p.prototype={constructor:p,destroy:function(){this.element.removeData("colorpickerplus").off(".colorpickerplus"),this.input!==!1&&this.input.off(".colorpickerplus"),this.element.trigger({type:"destroy"})},reposition:function(){n(this)},show:function(){this.reposition(),a(window).on("resize.colorpickerplus",a.proxy(this.reposition,this)),a(window.document).on({"mousedown.colorpickerplus":a.proxy(this.hide,this)}),l(this),this.element.trigger({type:"showPicker",color:this.getValue()})},hide:function(b){var c=a(b.target).closest(".colorpicker");c.length>0||(m(),a(window).off("resize.colorpickerplus",a.proxy(this.reposition,this)),a(document).off({"mousedown.colorpickerplus":a.proxy(this.hide,this)}),this.element.trigger({type:"hidePicker",color:this.getValue()}))},setValue:function(a){this.element.data("cpp-color",a),this.element.trigger({type:"changeColor",color:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("cpp-color"),(void 0===b||""===b||null===b)&&(b=a),"string"==typeof b?b.toUpperCase():b},hasInput:function(){return this.input!==!1}},a.colorpickerplus=p,a.fn.colorpickerplus=function(b){var c=arguments;return this.each(function(){var d=a(this),e=d.data("colorpickerplus"),f="object"==typeof b?b:{};e||"string"==typeof b?"string"==typeof b&&e[b].apply(e,Array.prototype.slice.call(c,1)):d.data("colorpickerplus",new p(this,f))})},a.fn.colorpickerplus.constructor=p});/*! bootstrap-ssdlg 2015-05-12 */
"use strict";!function(a){"function"==typeof define&&define.amd?define(["jquery","jquery-imagerect","bootstrap-colorpicker-plus","bootstrap-slider"],a):window.jQuery&&!window.jQuery.fn.shapeStyleDialog&&a(window.jQuery)}(function(a){var b=["Arial","Verdana","Helvetica","Courier","Times","Roboto","Oswald","Open Sans Condensed","Roboto Slab","Droid Serif","Roboto Condensed","Raleway","Bangers","Permanent Marker","Droid Sans Mono"],c=[9,10,11,12,13,14,16,18,20,24,36,48,64,72,96,110,127],d={strokeSize:1},e=function(e,f){var g=this;this.element=a(e),this.opts=a.extend({},d,this.element.data(),f),this.colorpickerembeds=a(".colorpickerembed.colorpickerplus-container",this.element),this.colorpickerembeds.colorpickerembed(),this.colorpickerembeds.on("changeColor",a.proxy(this.onOptChanged,this)),this.colorpickerpluss=a("button[data-toggle=colorpickerplus]",this.element),this.colorpickerpluss.colorpickerplus(),this.colorpickerpluss.on("changeColor",a.proxy(this.onOptChanged,this)),this.sliders=a("input[data-toggle=slider]",this.element).slider(),this.sliders.on("slideStop",a.proxy(this.onOptChanged,this)),a("ul[aria-labelledby]",this.element).each(function(){var d=a(this).attr("aria-labelledby");switch(d){case"fontFamilyDropdownMenu":for(var e=0;e<b.length;e++)a('<li data-ssdlg-key="font-family" data-ssdlg-val="'+b[e]+'"><a href="#">'+b[e]+"</a></li>").appendTo(a(this));break;case"fontSizeDropdownMenu":for(e=0;e<c.length;e++)a('<li data-ssdlg-key="font-size" data-ssdlg-val="'+c[e]+'"><a href="#">'+c[e]+"px</a></li>").appendTo(a(this))}}),this.element.on("click","button[data-toggle=dropdown]",function(){var b=a(this),c=b.attr("id"),d=a("ul[aria-labelledby="+c+"]",a(e)),f=a("li",d);f.each(function(){var b=a(this).data("ssdlg-key"),c=a(this).data("ssdlg-val");return null!==b&&c===g.option[b]?!1:void 0})}),this.element.on("click","li[data-ssdlg-key],button[data-ssdlg-val],a[data-ssdlg-key]",function(){var b=a(this).data("ssdlg-key");if(null!=b){var c=a(this).data("ssdlg-val");switch(b){case"font-style":c="italic"===c?"normal":"italic",a(this).data("ssdlg-val",c);break;case"font-weight":c="bolder"===c?"normal":"bolder",a(this).data("ssdlg-val",c);break;case"font-decoration":c="underline"===c?"line-through":"line-through"===c?"overline":"overline"===c?"":"underline",a(this).data("ssdlg-val",c);break;default:0===b.indexOf("font-align-")&&(c=g.handleFontAlign(a(this),b.substring(11)),b="font-align")}g.changeOpt(b,c,a(this))}}),a("input[data-ssdlg-key]",this.element).on("blur",a.proxy(this.inputBlur,this));var h=a("#tab_image"),i=a(".imagerect",h).imagerect();i.on("load",a.proxy(this.imgload,this)),i.on("pick",a.proxy(this.imagepick,this)),this.imgpicker=i,a("input",h).on("blur",a.proxy(this.imagePickerBlur,this)),a('a[data-toggle="tab"]',this.element).on("show.bs.tab",function(b){a(".nav-tabs > li.active",this.element).removeClass("active");var c=a(b.target).attr("href");a('a[href="'+c+'"]',a(".nav-tabs",this.element)).parent().addClass("active")}),a('a[data-toggle="tab"]',this.element).on("shown.bs.tab",a.proxy(this.tabShown,this)),a(".slider",this.element).on("click touchstart",a.proxy(this.stopPropagation,this)),a("#ssdlg-link-btn").on("click",function(){a("#ssdlg-link-panel").toggle()}),a("#ssdlg-link-panel").toggle()};e.version="0.1.0",e.prototype={constructor:e,setDlgItemStyle:function(b,c,d){switch(b){case"fillStyle":var e=a(".shapestyle-dlg-background-icon",d.closest(".dropdown-colorpickerplus"));null!=c?(e.removeClass("colorpicker-color"),e.css("background-color",c)):(e.removeAttr("style"),e.addClass("colorpicker-color"));var f=this.colorpickerembeds.index('[data-ssdlg-key="fillStyle"]');this.colorpickerembeds.eq(f).colorpickerembed("update",c);break;case"strokeStyle":var g=a(".shapestyle-dlg-line",this.element);null!=c?(g.removeClass("colorpicker-color"),g.css("background-color",c)):g.addClass("colorpicker-color"),this.colorpickerembeds.eq(this.colorpickerembeds.index('[data-ssdlg-key="strokeStyle"]')).colorpickerembed("update",c);break;case"x":case"y":case"w":case"h":case"r":a('input[data-ssdlg-key="'+b+'"]',this.element).val(c);break;case"alpha":this.sliders.slider("setValue",c);break;default:if(0===b.indexOf("font-")){var h=a('button[data-ssdlg-key="'+b+'"]');h.data("ssdlg-val",c)}}},changeOpt:function(a,b,c){("object"==typeof b||this.opts[a]!==b)&&(this.opt(a,b,c),this.element.trigger({type:"optionChange",key:a,val:b}))},onOptChanged:function(b){var c=a(b.target).data("ssdlg-key");this.changeOpt(c,b.color||b.value,a(b.target))},opt:function(a,b,c){this.opts[a]=b,this.setDlgItemStyle(a,b,c)},setCPPColor:function(b,c){var d=a('button[data-toggle=colorpickerplus][data-ssdlg-key="'+b+'"]',this.element);d.data("cpp-color",c),this.opt(b,c,d)},option:function(b){if(b){this.opts=a.extend({},d,this.element.data(),b);for(var c in b)switch(c){case"strokeStyle":this.setCPPColor(c,b[c]);break;case"fillStyle":this.opt(c,b[c],a('div[data-ssdlg-key="'+c+'"]',this.element));break;default:this.opt(c,b[c])}}return this.opts},handleFontAlign:function(a,b){var c="font-align",d=a.data("ssdlg-val");return a.data("ssdlg-val",d===b?0:b),d=d===b?this.opts[c]|b:this.opts[c]&~b},imgload:function(a){this.element.trigger({type:"imgload",relatedTarget:a.relatedTarget});var b=this.imgpicker.imagerect("rect");this.onImgRect(b)},imagepick:function(a){var b=a.value;this.onImgRect(b)},imgInput:function(){var a=this.imgPickerUrl.val();a?this.imgpicker.imagerect("option",{url:a}):this.imgPickerUrl.tooltip("show")},onImgRect:function(b){for(var c in b){var d="#formRectP"+c.toUpperCase();a(d).val(Math.round(b[c]*this.imgpicker.data("imagerect").percent*100)/100)}var e=this.imgpicker.imagerect("option");b.url=e.url,this.changeOpt("img",b)},imagePickerBlur:function(b){var c=a(b.target),d=c.val(),e=c.attr("id"),f=null;switch(a.isNumeric(d)&&(d/=this.imgpicker.data("imagerect").percent),e){case"formRectPX":f={x:d};break;case"formRectPY":f={y:d};break;case"formRectPW":f={w:d};break;case"formRectPH":f={h:d};break;case"imgPickerUrl":d?this.imgpicker.imagerect("option",{url:d}):c.tooltip("show")}if(f){f=this.imgpicker.imagerect("rect",f);var g=this.imgpicker.imagerect("option");this.changeOpt("img",a.extend({url:g.url},f))}},inputBlur:function(b){var c=a(b.target),d=c.val(),e=c.data("ssdlg-key");this.changeOpt(e,d)},stopPropagation:function(a){a.stopPropagation()},tabShown:function(b){var c=a(b.target).attr("href");"#tab_image"===c&&this.opts.img&&this.imgpickerUpdate()},imgpickerUpdate:function(){this.imgpicker.imagerect("rect",this.opts.img)}},a.shapeStyleDialog=e,a.fn.shapeStyleDialog=function(b){var c=arguments,d=null;return this.each(function(){var f=a(this),g=f.data("shapeStyleDialog"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(d=g[b].apply(g,Array.prototype.slice.call(c,1))):f.data("shapeStyleDialog",new e(this,h))}),d||this},a.fn.shapeStyleDialog.constructor=e});/*! jh2d 2015-05-15 */
"use strict";!function(a,b,c){a.plugins={},a.dashes=[[4,4],[8,4,4,4],[8,4,4,4,4,4,8,4]];var d={style:"normal",weight:"normal",size:12,family:"sans-serif",align:0,color:"rgba(0,0,0,0.87)",pos:0};a.DEF_TEXT_OPT=d;var e=1,f=2,g=4,h=8;a.EAST=e,a.NORTH=f,a.WEST=g,a.SOUTH=h;var i=1,j=2,k=4,l=8,m=16,n=32,o=n|i,p=10;a.ACT_MOVE=i,a.ACT_RESIZE=j,a.ACT_ROTATE=k,a.ACT_EX_MOVE=l,a.ACT_SELECT=m,a.ACT_NEW_DROP=o;var q=function(a,b,c,d){return"object"==typeof a?q(a.x,a.y,a.w,a.h):[a+c/2,b+d/2]},r=function(a,b){return[b[0]-a[0],b[1]-a[1]]},s=function(a,b){var c=r(a,b);return Math.sqrt(c[0]*c[0]+c[1]*c[1])};a.center=q,a.delta=r,a.direction=function(a,b,c,d,e){var f=d/c,g=this.center(a,b,c,d),h=e[0]-g[0],i=e[1]-g[1],j=0;return i>=Math.abs(h*f)&&(j=this.SOUTH),i<=-1*Math.abs(h*f)&&(j=this.NORTH),h>=Math.abs(i/f)&&(j=this.EAST),h<=-1*Math.abs(i/f)&&(j=this.WEST),j};var t=function(a){if(null!=a&&"object"==typeof a){if(da(a)){for(var b=[],c=0;c<a.length;c++)b[b.length]=t(a[c]);return b}var d={};for(var e in a)d[e]=t(a[e]);return d}return a},u=function(a,b){for(var c=!1,d=0;d<a.length&&!(c=b===a[d]);d++);return c},v=function(b,c,d,e){if("object"==typeof c)for(var f in c){var g=da(e)&&u(e,f);"function"==typeof e&&(g=e.call(a,f)),g||((null==b[f]||d)&&("object"==typeof c[f]&&null!=c[f]?b[f]=t(c[f]):b[f]=t(c[f])),null==b[f]&&delete b[f])}return b};a.clone=t,a.extend=v,a.inArray=u;var w=3,x=function(a,b,c,d){a.strokeStyle="#000",a.beginPath(),a.arc(b,c,w,0,2*Math.PI,!1),a.closePath(),a.fillStyle=d||"#fff",a.fill(),a.stroke()},y=function(a,b,c,d,e){for(var f=[0,1,2,-1],g=c/2,h=d/2,i=-1,j=0;8>j;j++){var k=j%f.length,l=0,m=0;switch(f[k]){case 0:i*=-1,l=a+g+g*i,m=b+h;break;case 1:l=a+g+g*i,m=b+h-h*i;break;case 2:l=a+g,m=b+h-h*i;break;case-1:l=a+g-g*i,m=b+h-h*i}if(e(l,m,j))return j}return-1},z=function(a,b,c,d){return Math.pow(d-b,2)+Math.pow(c-a,2)<=Math.pow(w+2,2)},A=function(a,b,c){return y(a.x,a.y,a.w,a.h,function(d,e,f){var g=!0;if(null!=a.adjPoint){var h=Math.pow(2,f);g=(h&a.adjPoint)===h}return g&&z(d,e,b,c)})},B=function(a,b){var c=C(b),d=0;a.beginPath(),a.moveTo(c[d++],c[d++]),a.lineTo(c[d++],c[d++]+b.h/2*-1),a.stroke(),d=0,x(a,c[d++],c[d++],"#0f0")},C=function(a){var b=[a.w/2,a.h/Math.abs(a.h)*15*-1,a.w/2,a.h/2],c=a.x,d=a.y,e=0;return[c+b[e++],d+b[e++],c+b[e++],d+b[e++]]},D=function(a){return a.rc||C(a).slice(2)},E=function(b,c,d){b.save();var e=c.rc||D(c),f=c.x+(c.dx||0),g=c.y+(c.dy||0),h=e[0],i=e[1],j=c.rotate||0;0!==j&&(b.translate(h,i),b.rotate(j),f-=h,g-=i);var k=c.style;null==k&&(k=3);var l=1===(1&k),m=2===(2&k),n=c.dashedStyle,o=parseInt(c.shadowOffset),p=c.shadowAngle,q=c.gradient||0,r=c.alpha||1;-1!==r&&(b.globalAlpha=r);var s=a.plugins[c.type];if(s){c.strokeSize&&(b.lineWidth=c.strokeSize),b.strokeStyle=c.strokeStyle||"rgba(0,0,0,0.54)";var t=a.extend({x:f,y:g},c);b.beginPath();var u=null;isNaN(parseInt(n))||(u=a.dashes[n]);var v=c.strokeBefore||!1;if(s.renderer.call(s,b,t,u),null!=p&&!isNaN(o)){b.shadowColor=c.shadowColor||"RGBA(127,127,127,1)";var w=D(c),x=a.rotate(w,[w[0]+o,w[1]],p);b.shadowOffsetX=x[0]-w[0],b.shadowOffsetY=x[1]-w[1],b.shadowBlur=null==c.shadowBlur?5:c.shadowBlur,v=!0}v&&m&&b.stroke(),l&&(b.fillStyle=c.fillStyle||"#fff",0!==q&&F(b,c,f,g),b.fill()),!v&&m&&b.stroke(),c.img&&H(b,t),null!=d&&1===(1&d)&&S(b,t),c.text&&(b.save(),L(b,c,f,g),b.restore())}b.restore()},F=function(b,c,d,i){var j=c.gradient||0,k=c.gradientType||0,l=0>j;j=Math.abs(j);var m,n,o,p,q=d,r=d,s=i,t=i,u=0,v=0,w=null;if(0===k){j===(e|f)&&(m=c.h/c.w,n=-1/m,o=n*c.w/(n-m),p=m*o,u=o-c.w/2,v=p-c.h/2),j===(g|f)&&(m=-1*c.h/c.w,n=-1/m,o=m*c.w/(m-n),p=n*o,u=o-c.w/2,v=p-c.h/2),(j&e)===e&&(q=d+c.w-u,r=d+u),(j&f)===f&&(s=i-v,t=i+c.h+v),(j&g)===g&&(q=d-u,r=d+c.w+u),(j&h)===h&&(s=i-v,t=i+c.h+v);var x=c.rotate||0;if(0!==x&&c.gradientFixed){var y=a.rotate([0,0],[q,s],x,-1),z=a.rotate([0,0],[r,t],x,-1);q=y[0],s=y[1],r=z[0],t=z[1]}w=b.createLinearGradient(q,s,r,t)}else{var A=0,B=0;0===j||j===(e|f|g|h)?(q=d+c.w/2,s=i+c.h/2,r=q,t=s,B=Math.sqrt(c.w*c.w+c.h*c.h)/2):(q=d+c.w/2,s=i+c.h/2,(j&e)===e&&(q=d+c.w-u),(j&f)===f&&(s=i-v),(j&g)===g&&(q=d-u),(j&h)===h&&(s=i+c.h+v),r=q,t=s,B=Math.max(Math.abs(c.w),Math.abs(c.h))),w=b.createRadialGradient(q,s,A,r,t,B)}for(var C=c.gradientCnt||2,D=c.gradientColors||[c.fillStyle,"#ffffff"],E=1/(C-1),F=0;C>F;F++){var G=F===C-1?1:F*E,H=F%D.length;l&&(H=D.length-H-1);var I=D[H];w.addColorStop(G,I)}b.fillStyle=w};a.resource_cache={};var G=a.resource_cache,H=function(a,b){var c="string"==typeof b.img?b.img:b.img.url;null!=c&&G[c]&&K(a,b,G[c])},I=function(a){for(var b=!0,c=0;c<a.length;c++){var d=a[c];if(d.img){var e="string"==typeof d.img?d.img:d.img.url;if(b=!!G[e],!b)break}}return b},J=function(a,b,c){var d=new Image;d.onload=function(e){G[e.target.src]=d,I(a)&&b.call(c||a)};for(var e=0;e<a.length;e++){var f=a[e];if(f.img){var g="string"==typeof f.img?f.img:f.img.url;null==G[g]&&(d.src=g)}}},K=function(a,b,c){a.clip();var d=0,e=0,f=0,g=0,h=b.x,i=b.y,j=b.w,k=b.h,l=1;"object"==typeof b.img&&(d=b.img.x||d,e=b.img.y||e,f=b.img.w||c.width,g=b.img.h||c.height,0>d&&(l=b.w/f,h-=d*l,f+=d,j=f*l),0>e&&(l=b.h/g,i-=e*l,g+=e,k=g*l),d=Math.max(d,0),e=Math.max(e,0),f=Math.min(f,c.width),g=Math.min(g,c.height)),a.drawImage(c,d,e,f,g,h,i,j,k)},L=function(a,b,c,i){c=c||b.x,i=i||b.y;var j=0,k=c,l=i,m=v(b.textOpt||{},d,!1),n=" ",o=m.size;"number"==typeof parseInt(o)&&(o+="px");var p=m.style+n+m.weight+n+o+n+m.family;a.font=p,a.fillStyle=m.color;var q=b.text.split(/\n|<br[\/]{0,1}\>/);j=a.measureText(q[0]);for(var r=1;r<q.length;r++){var s=a.measureText(q[r]);s.width>j.width&&(j=s)}var t=M(m.family,o);k=c+b.w/2,l=i+b.h/2,a.textAlign="center",a.textBaseline="middle";var u=m.align;(u&e)===e&&(k=c+b.w,a.textAlign="right"),(u&g)===g&&(k=c,a.textAlign="left"),(u&h)===h&&(l=i+b.h,a.textBaseline="bottom"),(u&f)===f&&(l=i,a.textBaseline="top");var w=m.pos;for((w&e)===e&&(k+=b.w),(w&g)===g&&(k-=b.w),(w&h)===h&&(l+=b.h),(w&f)===f&&(l-=b.h),b.textOpt=m,b.textOpt.x=k,b.textOpt.y=l,b.textOpt.w=j,b.textOpt.h=t,r=0;r<q.length;r++){var x=l+r*t.height;a.fillText(q[r],k,x),m.decoration&&N(a,m.decoration,b)}},M=function(a,b){var c=document.createElement("span");c.innerHTML="Hg",c.style.fontFamily=a,c.style.fontSize=b,c.style.padding="0px",c.style.margin="0px";var d=document.createElement("div");d.style.display="inline-block",d.style.width="1px",d.style.height="0px";var e=document.createElement("div");e.style.padding="0px",e.style.margin="0px",e.style.border="1px solid",e.appendChild(c),e.appendChild(d),document.body.appendChild(e);var f={};try{d.style.verticalAlign="baseline",f.ascent=O(d).top-O(c).top,d.style.verticalAlign="bottom",f.height=O(d).top-O(c).top,f.descent=f.height-f.ascent}finally{e.remove()}return f},N=function(a,b,c){var d=c.textOpt,i=d.h,j=d.w,k=i.height-i.descent/3,l=j.width,m=d.align,n=c.x+c.w/2,o=c.y+c.h/2,p=[n-l/2,o],q=[n+l/2,o],r=0;switch(b.toLowerCase()){case"line-through":r=0;break;case"underline":r=1;break;case"overline":r=-1}a.beginPath(),a.lineWidth=parseInt(d.size/12),a.strokeStyle=d.color||"#000",(m&e)===e&&(p[0]=c.x+c.w-l,q[0]=c.x+c.w),(m&g)===g&&(p[0]=c.x,q[0]=c.x+l),(m&h)===h&&(o+=(c.h-k)/2),(m&f)===f&&(o-=(c.h-k)/2),p[1]=o+r*k/2,q[1]=o+r*k/2;var s=d.pos;(s&e)===e&&(p[0]+=c.w,q[0]+=c.w),(s&g)===g&&(p[0]-=c.w,q[0]-=c.w),(s&h)===h&&(p[1]+=c.h,q[1]+=c.h),(s&f)===f&&(p[1]-=c.h,q[1]-=c.h),a.moveTo(p[0],p[1]),a.lineTo(q[0],q[1]),a.stroke()},O=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}};a.draw=function(a,b,c,d,e){a.save(),a.scale(c,c);var f=0;if(b.length)if(e)for(f=0;f<e.length;f++){var g=e[f];E(a,b[g],d!==g||b[g].conn?0:1)}else for(f=0;f<b.length;f++)E(a,b[f],d!==f||b[f].conn?0:1);else E(a,b);a.restore()};var P=function(a,b,c,d){a.save(),a.beginPath();for(var e=p*(d||1),f=b/e,g=0;f>g;g++)a.moveTo(g*e,0),a.lineTo(g*e,c);for(f=c/e,g=0;f>g;g++)a.moveTo(0,g*e),a.lineTo(b,g*e);a.strokeStyle="rgba(187,187,187,0.26)",a.stroke(),a.restore()},Q=function(b,c,d,e){b.save(),b.scale(d,d);var f=D(c),g=c.x,h=c.y,i=f[0],j=f[1],k=c.rotate||0;0!==k&&(b.translate(i,j),b.rotate(k),g-=i,h-=j);var l=a.extend({x:g,y:h},c),m=c.conn?"#0f0":null;y(g,h,c.w,c.h,function(a,d,f){var g=!0;if(null!=c.adjPoint){var h=Math.pow(2,f);g=(h&c.adjPoint)===h}if(g){var i=m;if(da(e))for(var j=0;j<e.length;j++){var k=e[j];if(k[1]===f){i="#f00";break}}x(b,a,d,i)}}),(null==c.adjPoint||256===(256&c.adjPoint))&&B(b,l),$(b,l),b.restore()},R=function(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(b+d,c+e),a.moveTo(b+d,c),a.lineTo(b,c+e),a.stroke()},S=function(a,b){a.save(),a.strokeStyle="#00f";for(var c=T(b),d=5,e=0;e<c.length;e++)R(a,c[e][0]-d/2,c[e][1]-d/2,d,d);a.restore()},T=function(b){var c=a.plugins[b.type];return c&&c.getConnectPts?c.getConnectPts.call(c,b):U(b)},U=function(a){var b=a.x+a.w/2,c=a.y+a.h/2;return[[b,a.y],[a.x+a.w,c],[b,a.y+a.h],[a.x,c]]},V=function(a,b){var c=T(a);return Y(a,c[X(c,Y(a,b,-1))])},W=function(a,b){var c=T(a);return X(c,Y(a,b,-1))},X=function(a,b){for(var c=0,d=0,e=0;e<a.length;e++){var f=s(b,a[e]);0===e?c=f:c>f&&(c=f,d=e)}return d},Y=function(b,c,d){var e=b.rotate||0;if(0!==e){var f=a.rotate(D(b),c,e,d||1);c[0]=f[0],c[1]=f[1]}return c},Z=function(a,b){var c=T(a)[b[3]];return Y(a,c)};a.defConnectPts=U;var $=function(b,c){if(c.ex){var d=function(d){var e=a.plugins[c.type];if(e&&e.drawExPoint)e.drawExPoint.call(e,b,c,d);else{var f=d.dx,g=d.dy;x(b,c.x+f,c.y+g,"#ffff00")}},e=c.ex;if(da(e))for(var f=0;f<e.length;f++){var g=e[f];d(g)}else d(e)}};a.reg=function(b){a.extend(a.plugins,b)};var _=function(a,b,c,d){return d=d||1,[(b[0]-a[0])*Math.cos(c)-d*(b[1]-a[1])*Math.sin(c)+a[0],d*(b[0]-a[0])*Math.sin(c)+(b[1]-a[1])*Math.cos(c)+a[1]]},aa=function(a,b,c,d){var e=(b[1]-a[1])/(b[0]-a[0]),f=(b[1]-c[1])/(b[0]-c[0]),g=(a[1]-c[1])/(a[0]-c[0]),h=(e*(d[0]-b[0])-(d[1]-b[1]))*(e*(c[0]-b[0])-(c[1]-b[1])),i=(f*(d[0]-b[0])-(d[1]-b[1]))*(f*(a[0]-b[0])-(a[1]-b[1])),j=(g*(d[0]-a[0])-(d[1]-a[1]))*(g*(b[0]-a[0])-(b[1]-a[1]));return h>0&&i>0&&j>0},ba=function(a,b,c,d,e){var f=[a,b],g=[a+c,b],h=[a,b+d],i=[a+c,b+d];return aa(f,g,h,e)||aa(g,h,i,e)},ca=function(a){for(var b=a.offsetLeft,c=a.offsetTop,d=a.offsetParent;null!==d;)b=parseInt(b)+parseInt(d.offsetLeft),c=parseInt(c)+parseInt(d.offsetTop),d=d.offsetParent;return new Array(b,c)};a.inTriangle=aa,a.inRect=ba;var da=function(a){return"[object Array]"===Object.prototype.toString.call(a)};a.rotate=_,a.isArray=da;var ea=["e-resize","ne-resize","n-resize","nw-resize","w-resize","sw-resize","s-resize","se-resize"],fa=[1,3,2,6,4,12,8,9],ga=function(a,b,c,d,e,f,g){if(e=null==e?-1:e,a.ex){var h=function(b,c,e){switch(d){case 1:b.dx+=c,b.dy+=e;break;case 0:b.dx=c,b.dy=e;break;case 2:if(0===a.w||0===a.h)return;b.dx=a.w/Math.abs(a.w)*Math.abs(b.dx*(1-f)),b.dy=a.h/Math.abs(a.h)*Math.abs(b.dy*(1-g))}},i=a.ex;if(da(a.ex)){for(var j=0;j<i.length;j++)if(-1===e||e===j){var k=i[j];if(h(k,b,c),e===j)break}}else h(i,b,c)}},ha=function(a,b,c){if(a.ex){var d=function(d){var e,f;return e=a.x+d.dx,f=a.y+d.dy,z(e,f,b,c)};if(da(a.ex))for(var e=0;e<a.ex.length;e++){var f=a.ex[e];if(d(f))return e}else if(d(a.ex))return 0}return-1},ia=function(a,b,c,d,e,f){1===(1&fa[c])&&(a.w=b.w+b.w*e,d||ga(a,b.w*e,0,1,-1,e,f)),2===(2&fa[c])&&(a.y=b.y+b.h*f,a.h=b.h-b.h*f,d&&ga(a,0,-1*b.h*f,1,-1,e,f)),4===(4&fa[c])&&(a.x=b.x+b.w*e,a.w=b.w-b.w*e,d?ga(a,-1*b.w*e,0,1,-1,e,f):ga(a,-1*b.w*e,0,2,-1,e,f)),8===(8&fa[c])&&(a.h=b.h+b.h*f)},ja=function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];if(-1===ma(c,e)){var f=la(a,e);-1!==f?c[c.length]=a.splice(f,1)[0]:c[c.length]=e}}return c.length>0&&(a[a.length]=c),a},ka=function(a,b){for(var c=a[b],d=[b,1],e=0,f=0;f<c.length;f++){var g=c[f];da(g)&&(d[d.length]=g,e++)}return Array.prototype.splice.apply(a,d),e},la=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(-1!==ma(d,b))return c}return-1},ma=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(da(d)){if(-1!==ma(d,b))return c}else if(d===b)return c}return-1},na=function(a,b){var c=null,d=0;c=da(b[d])?na(a,b[d]):a[b[d]],d=1;for(var e=oa(c),f=0;d<b.length;d++){c=da(b[d])?na(a,b[d]):a[b[d]];var g=oa(c);e[f]=Math.min(e[f],g[f++]),e[f]=Math.min(e[f],g[f++]),e[f]=Math.max(e[f],g[f++]),e[f]=Math.max(e[f],g[f++])}f=0;var h=e[f++],i=e[f++],j=e[f++],k=e[f++];return{x:h,y:i,w:j-h,h:k-i}},oa=function(a){var b=a.x,c=a.x+a.w,d=a.y,e=a.y+a.h,f=Math.min(b,c),g=Math.min(d,e),h=f+Math.abs(a.w),i=g+Math.abs(a.h);return[f,g,h,i]},pa=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];da(d)?b=b.concat(pa(d)):b[b.length]=d}return b},qa=function(a,b){for(var c=[],d=a.concat(b),e=0;e<d.length;e++){var f=d[e];-1===sa(c,f)&&(c[c.length]=f)}return c},ra=function(a){var b=pa(a);return b.join("_")},sa=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d===b)return c}return-1},ta={allScale:1,selectedIndexs:[],groups:[],groupSprites:{},curIndex:-1,connectingSprites:[]},ua=function(a,b){var c=this;this.data=[],this.ctx=a.getContext("2d"),this.w=a.getAttribute("width"),this.h=a.getAttribute("height");var d=ca(a);return this.offsetLeft=d[0],this.offsetTop=d[1],this.options=v(b||{},ta),this.connModeFlag=!1,this.action=0,this.newSprite=null,this.downX=0,this.downY=0,this.moveX=0,this.moveY=0,this.upX=0,this.upY=0,this.mDownFlag=!1,this.downRotate=0,this.moveRotate=0,this.overInd=-1,this.scalex=0,this.scaley=0,this.exIndex=-1,this.exFreezed=!1,this.resizeInd=-1,this.assistSprites=[],this.cursor="default",this.multiSelect=!1,a.addEventListener("mousedown",function(a){c._onMousedown(a)}),a.addEventListener("mousemove",function(a){c._onMousemove(a)}),a.addEventListener("mouseup",function(a){c._onMouseup(a)}),c};ua.prototype={startRefresh:function(){var a=this;null!=this.interval&&clearInterval(this.interval),this.interval=setInterval(function(){a.update()},1e3/60)},stopRefresh:function(){clearInterval(this.interval),this.interval=null},newMode:function(a,b){this.newSprite=a,this._init(this.newSprite),this.action=b||n,this.startRefresh()},connectMode:function(){this.connModeFlag=!0,this.startRefresh()},_init:function(b){var c=a.plugins[b.type];null!=c&&c.init&&c.init.call(c,b)},add:function(a){if(da(a)){for(var b=0;b<a.length;b++)this._init(a[b]);a.length>0&&(this.data=this.data.concat(a))}else this._init(a),this.data[this.data.length]=a;return this},setData:function(a,b){this.reset(),this.options=v(b||{},ta),this.data=[],this.add(a)},remove:function(a){return this.splice(a,1),this},splice:function(){return this.data.splice(arguments)},reset:function(){this.action=0,this.resizeInd=-1,this.mDownFlag=!1,this.moveRotate=0,this.downRotate=0,this.exIndex=-1,this.scalex=0,this.scaley=0,this.exFreezed=!1,this.connModeFlag=!1,this.stopRefresh()},show:function(){var b=this.ctx;return this.options.background&&P(b,this.w,this.h),a.draw(b,this.data,1,-1,this.getOrderIndexs()),J(this.data,function(){a.draw(b,this.data,1,-1,this.getOrderIndexs())},this),this},getSprite:function(a){return this.data[a]},getCurIndex:function(){return this.options.curIndex},indexOf:function(b,c){for(var d=this.getOrderIndexs(),e=d.length-1;e>=0;e--){var f=d[e],g=this.data[f],h=b,i=c,j=g.rotate||0;if(0!==j){var k=a.rotate(a.center(g.x,g.y,g.w,g.h),[h,i],j,-1);h=k[0],i=k[1]}var l=a.plugins[g.type];if(l&&l.isOver){if(l.isOver.call(l,h,i,g))return f}else if(ba(g.x,g.y,g.w,g.h,[h,i]))return f}return-1},indexsOf:function(a,b,c,d){for(var e=[],f=Math.min(a,c),g=Math.max(a,c),h=Math.min(b,d),i=Math.max(b,d),j=0;j<this.data.length;j++){var k=this.data[j];k.x>=f&&k.x<=g&&k.y>=h&&k.y<=i&&k.x+k.w>=f&&k.x+k.w<=g&&k.y+k.h>=h&&k.y+k.h<=i&&(e[e.length]=j)}return e},getOrderIndexs:function(){var a=[],b=0;if(this.orderIndexs){if(this.orderIndexs.length!==this.data.length){for(b=0;b<this.data.length;b++){for(var c=b,d=0;d<this.orderIndexs.length;d++)b===this.orderIndexs[d]&&(c=this.orderIndexs[d]);a[b]=c}this.orderIndexs=a}}else{for(a=[],b=0;b<this.data.length;b++)a[b]=b;this.orderIndexs=a}return this.orderIndexs},getSelectedCount:function(){for(var a=this.options.selectedIndexs,b=this.options.groups,c=[],d=0,e=0;e<a.length;e++){var f=ma(b,a[e]);-1!==f?-1===c.join().indexOf(f+"")&&(c[c.length]=f,d++):d++}return d},getSelecteds:function(){for(var a=this.options.selectedIndexs,b=[],c=0;c<a.length;c++)b[b.length]=this.data[a[c]];return b},isSelected:function(a){for(var b=this.options.selectedIndexs,c=!1,d=0;d<b.length;d++)if(a===b[d]){c=!0;break}return c},removeSelected:function(){for(var a=this.options.selectedIndexs,b=[],c=[],d=0;d<this.data.length;d++)u(a,d)?b[b.length]=this.data[d]:c[c.length]=this.data[d];return b.length>0?this.reset():b=null,this.data=c,this.options.selectedIndexs=[],b},select:function(a){var b=this.options.selectedIndexs,c=function(a){u(b,a)||(b[b.length]=a)};if(da(a))for(var d=0;d<a.length;d++)c(a[d]);else c(a);return this},selectAll:function(){for(var a=0;a<this.data.length;a++)this.options.selectedIndexs[a]=a;return this},setMultiSelect:function(a){return this.multiSelect=a,this},_doMouseOver:function(b){var c=this,d=c.action,e=b.rotate||0,f=c.moveX,g=c.moveY,h=f,i=g,m=0;if(0!==e){var n=a.rotate(D(b),[h,i],e,-1);h=n[0],i=n[1],m=-1*Math.round(4*e/Math.PI)}if(c.exIndex=ha(b,h,i),-1!==c.exIndex)c.cursor="crosshair",d=l;else{var o=A(b,h,i);if(-1!==o){c.resizeInd=o,o+=m;var p=o%ea.length;0>p&&(p+=ea.length),c.cursor=ea[p],d=j}else{var q=null;(null==b.adjPoint||256===(256&b.adjPoint))&&(q=C(b)),null!=q&&z(q[0],q[1],h,i)&&(d=k,c.cursor="crosshair")}}c.action=d},_connSelectedCount:function(a){for(var b=0,c=0;c<a.length;c++)this.isSelected(a[c][2])&&b++;return b},_findConns:function(a){for(var b=this.options.connectingSprites,c=[],d=0;d<b.length;d++){var e=b[d];e[2]===a&&(c[c.length]=e)}return c},_doConns:function(a,b){for(var c=this._findConns(a),d=0;d<c.length;d++){var e=c[d];b.call(this,e,a)}},_findConnGrp:function(a){for(var b=this.options.connectingSprites,c=[],d=0;d<b.length;d++){var e=da(a)?a[0]:a;b[d][0]===e&&(c[c.length]=b[d])}return c},_clearConns:function(a,b){var c=this.options.connectingSprites;b=null==b?-1:b;for(var d=[],e=0;e<c.length;e++){var f=c[e],g=!1;g=-1!==b?f[0]===a&&f[1]===b:f[0]===a,g||(d[d.length]=f)}this.options.connectingSprites=d},_updateConn:function(a,b,c,d){var e,f,g=Z(a,c),h=this._findConnGrp(c),i=d||this.data[c[0]];3===c[1]?(e=g[0]-i.x,f=g[1]-i.y,b.x=i.x+e,b.y=i.y+f,h.length>1&&(b.w=i.w-e,b.h=i.h-f)):7===c[1]&&(e=g[0]-(i.x+i.w),f=g[1]-(i.y+i.h),1===h.length?(b.x=i.x+e,b.y=i.y+f):(b.w=i.w+e,b.h=i.h+f))},_dragEx:function(b,c,d){if(d.ex&&-1!==this.exIndex){var e,f,g=d.ex;da(g)&&(g=d.ex[this.exIndex]);var h=b,i=c,j=d.rotate||0;if(0!==j){var k=a.rotate(D(d),[h,i],j,-1);h=k[0],i=k[1]}e=h-d.x,f=i-d.y,ga(d,e,f,0,this.exIndex,this.scalex,this.scaley)}},moveBottom:function(a){var b=this.getOrderIndexs(),c=b[0];b[0]=a;for(var d=1;c!==a&&d<b.length;d++){var e=b[d];b[d]=c,c=e}return this},moveTop:function(a){var b=this.getOrderIndexs(),c=b.length,d=b[c-1];b[c-1]=a;for(var e=c-2;d!==a&&e>=0;e--){var f=b[e];b[e]=d,d=f}return this},moveDown:function(a){for(var b=this.getOrderIndexs(),c=b[0],d=1;c!==a&&d<b.length;d++){var e=b[d];e===a&&(b[d]=c,b[d-1]=a),c=e}return this},moveUp:function(a){var b=this.getOrderIndexs(),c=b.length,d=b[c-1];b[c-1]=a;for(var e=c-2;d!==a&&e>=0;e--){var f=b[e];f===a&&(b[e]=d,b[e+1]=a),d=f}return this},group:function(){var a=this.options.selectedIndexs,b=this.options.groups,c=this.options.groupSprites;if(a.length>1){console.log(a),ja(b,a);for(var d=0;d<b.length;d++){var e=b[d],f=ra(e),g=c[f];null==g&&(c[f]=na(this.data,e))}}return console.log(b),this},ungroup:function(){for(var a=this.options.selectedIndexs,b=this.options.groups,c=this.options.groupSprites,d=[],e=-1,f=0;f<a.length;f++)e=ma(b,a[f]),-1!==e&&-1===d.join().indexOf(e+"")&&(d[d.length]=e);d=d.sort();var g=0;for(f=0;f<d.length;f++){e=d[f]+g;var h=b[e],i=ra(h);delete c[i];var j=ka(b,e);0===j?g+=-1:j>1&&(g+=j-1)}return console.log(b),this},_doAlign:function(a,b,c){switch(b){case e:c.x=a.x+a.w-c.w;break;case f:c.y=a.y;break;case g:c.x=a.x;break;case h:c.y=a.y+a.h-c.h;break;case e|g:c.x=a.x+a.w/2-c.w/2;break;case f|h:c.y=a.y+a.h/2-c.h/2}return this},_doGrpAlign:function(a,b,c){var d=this.options.groups,e=this.options.groupSprites,f=d[c],g=ra(f),h=e[g],i=t(h);this._doAlign(a,b,h);for(var j=pa(f),k=0;k<j.length;k++){var l=j[k],m=this.data[l];m.x+=h.x-i.x,m.y+=h.y-i.y}},align:function(a){var b=this.options.selectedIndexs,c=this.options.groups,d=this.options.groupSprites,e=this.options.curIndex,f=null,g=ma(c,e);if(-1===g)f=this.data[e];else{var h=c[g],i=ra(h);f=d[i]}for(var j=[],k=0;k<b.length;k++){var l=b[k],m=ma(c,l);if(-1!==g&&g!==m)if(-1===m){var n=this.data[l];this._doAlign(f,a,n)}else-1===j.join().indexOf(m+"")&&(this._doGrpAlign(f,a,m),j[j.length]=m)}},zoom:function(a){return this.options.allScale=a,this.update(),this},getScale:function(){return this.options.allScale||1},_updateSprite:function(b,c,d,m){var n=this,o=n.options.allScale,p=n.options.selectedIndexs,q=n.options.groups,r=n.options.groupSprites,s=n.options.curIndex,t=n.downX,u=n.downY,v=n.moveX,w=n.moveY,x=n.scalex,y=n.scaley,z=n.assistSprites;if(b.conn&&p.length>1){var A=n._findConnGrp(c);if(1===n._connSelectedCount(A)&&c!==s)return}var B=null;0!==d&&(B=a.extend({style:2,dashedStyle:0,strokeSize:1},b),z[z.length]=B),(d&i)===i&&(B.x=b.x+v-t,B.y=b.y+w-u,n.exFreezed&&s===c&&ga(B,t-v,u-w,1,-1,x,y),a.draw(n.ctx,B,o));var C=-1,E=-1,F=null,G=null;if((d&k)===k&&(B.rotate=((b.rotate||0)+n.moveRotate)%(2*Math.PI),C=la(q,c),-1!==C?(G=q[C],E=ra(G),F=r[E],B.rc=D(F)):B.rc=D(b),a.draw(n.ctx,B,o)),(d&j)===j){if(n.data[s].conn&&s!==c)return;if(C=la(q,c),-1!==C){G=q[C],E=ra(G),F=r[E];var H=a.extend({},F);ia(H,F,m,n.exFreezed&&s===c,x,y),(fa[m]&e)===e&&(B.w=b.w*(1+x),B.x=(b.x-F.x)*(1+x)+F.x),(fa[m]&g)===g&&(B.w=b.w*(1-x),B.x=(b.x-F.x)*(1-x)+H.x),(fa[m]&f)===f&&(B.h=b.h*(1-y),B.y=(b.y-F.y)*(1-y)+H.y),(fa[m]&h)===h&&(B.h=b.h*(1+y),B.y=(b.y-F.y)*(1+y)+F.y)}else ia(B,b,m,n.exFreezed,x,y);if(B.rc=D(b),b.conn){var I=n.indexOf(v,w);if(s===c&&-1!==I&&I!==s&&-1!==c){var J=V(n.data[I],[v,w]);3===m?(B.x=J[0],B.y=J[1]):7===m&&(B.w=J[0]-B.x,B.h=J[1]-B.y)}}a.draw(n.ctx,B,o)}b.conn||null==B||n._doConns(c,function(b){var c=n._findConnGrp(b[0]);if(2!==n._connSelectedCount(c)){var d=n.data[b[0]],e=a.extend({style:2,dashedStyle:0,strokeSize:1},d);z[z.length]=e,n._updateConn(B,e,b),e.rc=D(d),a.draw(n.ctx,e,o)}}),(d&l)===l&&-1!==n.exIndex&&s===c&&(n._dragEx(v,w,B),a.draw(n.ctx,B,o))},_onMousedown:function(b){var c=this,d=c.options.disabled;if(!d){var e=c.options.allScale,f=c.options.selectedIndexs,g=c.options.groups,h=c.options.curIndex,i=c.action,j=c.newSprite,l=c.downX,o=c.downY,p=c.moveX,q=c.moveY;if(l=b.offsetX||b.layerX,o=b.offsetY||b.layerY,l/=e,o/=e,c.mDownFlag=!0,h=c.overInd,-1!==h){var r=c.data[h];c.isSelected(h)||(c.multiSelect?f[f.length]=h:(f=[],f[0]=h));var s=la(g,h);if(-1!==s&&(f=qa(f,pa(g[s]))),(i&k)===k){var t=D(r),u=l-t[0],v=o-t[1];c.downRotate=Math.atan2(v,u)}for(var w={curIndex:h,exInd:c.exIndex,data:c.data,selectedIndexs:f,resizeInd:c.resizeInd},x=null,y=0;y<f.length;y++){var z=f[y],A=c.data[z];x=a.plugins[A.type],x&&x.onActionStart&&(x.onActionStart.call(x,i,A,w),c.exIndex=w.exInd)}if(x=a.plugins[r.type],x&&x.exFreeze){var B=p,C=q,E=r.rotate||0;if(0!==E){var F=a.rotate(a.center(r.x,r.y,r.w,r.h),[B,C],E,-1);B=F[0],C=F[1]}c.exFreezed=x.exFreeze.call(x,B,C,r,i)}}else f=[],i===n&&j&&(j.x=l,j.y=o,j.w=1,j.h=1),0===i&&(i=m);c.options.selectedIndexs=f,c.options.curIndex=h,c.action=i,c.downX=l,c.downY=o,null==c.interval&&c.startRefresh()}},_onMousemove:function(b){var c=this,d=c.options.disabled;if(!d){var e=b.target||b.srcElement,f=c.options.allScale,g=c.options.selectedIndexs,h=c.options.groups,m=c.options.groupSprites,o=c.options.curIndex,p=c.action,q=c.newSprite,r=c.downX,s=c.downY,t=c.moveX,u=c.moveY,v=-1,w=null,x=null,y=-1;if(t=b.offsetX||b.layerX,u=b.offsetY||b.layerY,t/=f,u/=f,(p&n)!==n?c.mDownFlag||(c.overInd=c.indexOf(t,u)):c.overInd=-1,c.mDownFlag)if(-1===o)(p&n)===n&&q&&((p&i)===i?(q.x=t,q.y=u):(q.w=t-r,q.h=u-s));else if(v=la(h,o),w=null,-1===v?w=c.data[o]:(x=h[v],y=ra(x),w=m[y]),(p&k)===k){var z=D(w),A=t-z[0],B=u-z[1];c.moveRotate=Math.atan2(B,A)-c.downRotate}else if((p&j)===j){var C=t,E=u,F=r,G=s;if(w.rotate){var H=a.rotate(D(w),[C,E],w.rotate,-1),I=a.rotate(D(w),[F,G],w.rotate,-1);C=H[0],E=H[1],F=I[0],G=I[1]}0!==w.w&&(c.scalex=(C-F)/w.w),0!==w.h&&(c.scaley=(E-G)/w.h),c.connModeFlag=null!=w.conn?!!w.conn:!1}else(p&l)===l||(p&n)===n||(c.action=i);else{if(c.cursor="default",-1!==c.overInd&&(c.cursor="move"),(p&n)===n)q&&((p&i)===i?(q.x=t-q.w/2,q.y=u-q.h/2,c.cursor="move"):c.cursor="crosshair");else{c.action=0;for(var J=0;null!=g&&J<g.length;J++){var K=g[J];if(w=null,v=la(h,K),-1!==v&&(x=h[v],y=ra(x),w=m[y]),null==w&&(w=c.data[K]),c._doMouseOver(w),0!==c.action){c.overInd=K;break}}}e.style.cursor=c.cursor}c.moveX=t,c.moveY=u}},_onMouseup:function(b){var c=this,d=c.options.disabled;if(!d){var e=c.options.allScale,f=c.options.selectedIndexs,g=c.options.groups,h=c.options.groupSprites,l=c.options.curIndex,o=c.action,p=c.newSprite,q=c.scalex,r=c.scaley,s=c.resizeInd,u=c.downX,w=c.downY,x=c.upX,y=c.upY,z=c.assistSprites;x=b.offsetX||b.layerX,y=b.offsetY||b.layerY,x/=e,y/=e,c.stopRefresh();var A=0,B=-1,C=null;if(-1!==l){var D=null,E=[];for(A=0;c.mDownFlag&&A<f.length;A++){var F=f[A];if(D=c.data[F],B=la(g,F),-1!==B&&-1===E.join().indexOf(B+"")&&(E[E.length]=B),z.length>A&&a.extend(D,z[A],!0,["fillStyle","style","dashedStyle","strokeSize"]),D.rotate){var G=a.center(D);if(D.rc){var H=_(D.rc,G,D.rotate),I=H[0]-G[0],J=H[1]-G[1];D.x=D.x+I,D.y=D.y+J}}D.rc&&delete D.rc,D.conn||c._doConns(F,this._onSpConn)}for(A=0;A<E.length;A++){B=E[A];var K=g[B],L=ra(K),M=h[L];if(null!=M)if((o&i)===i)M.x=M.x+x-u,M.y=M.y+y-w;else if((o&k)===k)M.rotate=((M.rotate||0)+c.moveRotate)%(2*Math.PI);else if((o&j)===j){var N={};ia(N,M,c.resizeInd,!1,q,r),v(M,N,!0)}}for(A=0;c.mDownFlag&&A<f.length;A++)if(D=c.data[f[A]],D.conn){var O=c._findConnGrp(f[A]),P=c._connSelectedCount(O);if(2===P)for(var Q=0;Q<O.length;Q++)C=O[Q],c._updateConn(c.data[C[2]],D,C,t(D));else 0===P&&(o&i)===i&&c._clearConns(f[A])}D=c.data[l];var R=a.plugins[D.type];if(R&&R.onActionDone){var S={exInd:c.exIndex,data:c.data,selectedIndexs:f,resizeInd:s};R.onActionDone.call(R,o,D,S)}if(D.conn&&-1!==s){var T=c.indexOf(x,y);if(-1!==T){var U=-1,V=W(c.data[T],[x,y]),X=c.options.connectingSprites;for(A=0;A<X.length;A++)if(C=X[A],C[0]===l&&C[1]===s){U=A;break}-1===U?X[X.length]=[l,s,T,V]:(X[U][2]=T,X[U][3]=V)}else c._clearConns(l,s)}}else(o&m)===m&&(f=c.indexsOf(u,w,x,y));(o&n)===n&&p&&(l=c.data.length,c.add(p),f=[],f[f.length]=l),c.options.selectedIndexs=f,c.options.curIndex=l,c.upX=x,c.upY=y,c.reset(),c.update()}},_onSpConn:function(a,b){var c=this.data[b],d=this.data[a[0]];this.isSelected(a[0])||this._updateConn(c,d,a)},update:function(){var b=this,c=b.options.allScale,d=b.options.selectedIndexs,e=b.options.groups,f=b.options.groupSprites,g=b.action,h=b.newSprite,i=b.downX,l=b.downY,o=b.moveX,p=b.moveY,q=b.assistSprites;b.ctx.clearRect(0,0,b.w,b.h),this.options.background&&P(b.ctx,b.w,b.h,c);var r=-1;b.connModeFlag&&(r=b.indexOf(o,p)),a.draw(b.ctx,b.data,c,r,b.getOrderIndexs()),q.length=0;for(var s=[],t=-1,u=0;u<d.length;u++){var v=d[u];t=la(e,v);var w=b.data[v],x=[];if(w.conn&&(x=b._findConnGrp(v)),-1!==t?-1===s.join().indexOf(t+"")&&(s[s.length]=t):Q(b.ctx,w,c,x),!w.conn||g!==j&&g!==k||2!==b._connSelectedCount(x))(g&n)!==n&&b._updateSprite(w,v,g,b.resizeInd);else{var y=a.extend({style:2,dashedStyle:0,strokeSize:1},w);q[q.length]=y}}for(u=0;u<s.length;u++){t=s[u];var z=e[t],A=ra(z),B=f[A];null!=B&&Q(b.ctx,B,c)}(g&m)===m&&(o-i!==0||p-l!==0)&&a.dashedRect(b.ctx,i,l,o-i,p-l,a.dashes[0]),(g&n)===n&&h&&0!==h.x&&0!==h.y&&a.draw(b.ctx,h,c)}},a.instance=function(a,b){return new ua(a,b)}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b,c){var d=c.w/2,e=c.h/2,f=a-c.x-d,g=b-c.y-e;return Math.pow(f/d,2)+Math.pow(g/e,2)<1},e=function(b,c,d,e,f,g,h,i){for(var j=0,k=64,l=1/Math.sqrt(Math.pow(g-c,2)+Math.pow(f-b,2));1>=j;){var m=a.bezier([b,c,d,e,f,g],j);if(Math.pow(i-m[1],2)+Math.pow(h-m[0],2)<k)return!0;j+=l}return!1},f=function(b,c,d,e,f,g,h,i,j,k){for(var l=0,m=64,n=1/Math.sqrt(Math.pow(i-c,2)+Math.pow(h-b,2));1>=l;){var o=a.bezier([b,c,d,e,f,g,h,i],l);if(Math.pow(k-o[1],2)+Math.pow(j-o[0],2)<m)return!0;l+=n}return!1},g=[{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],h=function(a){for(var b=0;b<g.length;b++){var c=g[b],d=c.re.exec(a),e=d&&c.parse.apply(this,[d]);if(e)return e}return!1},i=function(a,b){var c=b||.8,d=h(a);if(d){var e=0;return j([d[e++]*c,d[e++]*c,d[e++]*c,1])}return a},j=function(a){var b=0;return"#"+(1<<24|a[b++]<<16|a[b++]<<8|a[b++]).toString(16).substr(1)},k=function(a,b,c,d){var e=c[0]-b[0],f=c[1]-b[1],g=0,h=0,i=-1;0!==e?(g=f/e,h=Math.atan(g)):h=Math.PI/2,0>g&&(i=1),c[1]<b[1]&&(i*=-1);var j=c[0],k=c[1];a.moveTo(j,k),a.lineTo(i*d*Math.cos(h-Math.PI/6)+j,i*d*Math.sin(h-Math.PI/6)+k),a.lineTo(i*d*Math.cos(h+Math.PI/6)+j,i*d*Math.sin(h+Math.PI/6)+k),a.closePath()},l=function(b,c,d){var e=[c.x,c.y],f=[c.x+c.w,c.y+c.h];if(d||b.moveTo(e[0],e[1]),c.ex){var g=e;if(a.isArray(c.ex))for(var h=0;h<c.ex.length;h++){var i=[c.ex[h].dx+c.x,c.ex[h].dy+c.y];a.dashedLine(b,g,i,d),g=i}else g=[c.ex.dx+c.x,c.ex.dy+c.y],a.dashedLine(b,e,g,d);a.dashedLine(b,g,f,d)}else a.dashedLine(b,e,f,d)},m=function(b,c){if(c.header){var d=10,e=[c.x,c.y],f=[c.x+c.w,c.y+c.h],g=null;if(c.ex){var h=e;if(a.isArray(c.ex)){if(c.ex.length>0){var i=0;1===(1&c.header)&&(i=c.ex.length-1,g=c.ex[i],h=[g.dx+c.x,g.dy+c.y],k(b,h,f,d)),2===(2&c.header)&&(i=0,g=c.ex[i],h=[g.dx+c.x,g.dy+c.y],k(b,h,e,d))}}else h=[c.ex.dx+c.x,c.ex.dy+c.y],1===(1&c.header)&&k(b,h,f,d),2===(2&c.header)&&k(b,h,e,d)}else 1===(1&c.header)&&k(b,e,f,d),2===(2&c.header)&&k(b,f,e,d)}},n=function(a,b,c){var d=c[1]-b[1],e=c[0]-b[0],f=Math.sqrt(Math.pow(d,2)+Math.pow(e,2));d=a[1]-b[1],e=a[0]-b[0];var g=Math.pow(d,2)+Math.pow(e,2);d=c[1]-a[1],e=c[0]-a[0];var h=Math.pow(d,2)+Math.pow(e,2),i=Math.sqrt(g)+Math.sqrt(h);return f>=i-2},o=function(b,c){var d=[c.x,c.y],e=[c.x+c.w,c.y+c.h],f=!1;if(c.ex){var g=d;if(a.isArray(c.ex))for(var h=0;h<c.ex.length;h++){var i=[c.ex[h].dx+c.x,c.ex[h].dy+c.y];if(f=0===h?n(b,d,i):n(b,g,i),g=i,f)return f}else if(g=[c.ex.dx+c.x,c.ex.dy+c.y],f=n(b,d,g))return f;f=n(b,g,e)}else f=n(b,d,e);return f},p=function(b,c,d){if(c.ex){var e=c.ex.dx,f=c.ex.dy,g=[c.x+e,c.y+f],h=[c.x+c.w,c.y],j=[c.x+c.w-e,c.y],k=[c.x,c.y+f],l=[c.x+e,c.y+c.h],m=[c.x,c.y+c.h],n=[c.x+c.w,c.y+c.h-f];b.moveTo(h[0],h[1]),a.dashedLine(b,h,n,d),a.dashedLine(b,n,l,d),a.dashedLine(b,l,g,d);var o=c.fillStyle||"#fff";b.fillStyle=i(o),b.closePath(),b.fill();var p=c.style;null==p&&(p=3),2===(2&p)&&b.stroke(),b.beginPath(),b.moveTo(g[0],g[1]),a.dashedLine(b,g,h,d),a.dashedLine(b,h,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,g,d),a.dashedLine(b,g,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,k,d)}},q=function(b,c,d){if(c.ex){var e=c.ex.dy,f=[c.x,c.y+e/2],g=[c.x+c.w,c.y+e/2],h=[c.x+c.w,c.y+c.h-e/2],i=[c.x,c.y+c.h-e/2];a.dashedOval(b,{x:c.x,y:c.y,w:c.w,h:e},d),a.dashedLine(b,f,i,d),a.dashedOval(b,{x:c.x,y:c.y+c.h-e,w:c.w,h:e},d,[0,0,1,1]),b.moveTo(h[0],h[1]),a.dashedLine(b,h,g,d)}},r=function(b,c,d){var e,f,g=[c.x,c.y],h=[-1,0,1,0],i=[0,-1,0,1],j=c.w<0?-1:1,k=c.h<0?-1:1,l=-1,m=null;c.ex&&(m=[c.x+c.ex.dx,c.y+c.ex.dy],t(c,m,function(b,d,g){e=b,f=d,l=g,(l&(a.NORTH|a.SOUTH))===l&&c.h<0&&(l=(a.NORTH|a.SOUTH)^g),l===a.SOUTH&&(e=d,f=b),(l&(a.EAST|a.WEST))===l&&c.w<0&&(l=(a.WEST|a.EAST)^g),l===a.WEST&&(e=d,f=b)}));for(var n=[a.NORTH,a.EAST,a.SOUTH,a.WEST],o=0;4>o;o++){var p,q,r=[g[0]-c.w*h[o],g[1]-c.h*i[o]];if(c.corner){var s=[];s=[g[0]+c.corner*i[o]*j,g[1]-c.corner*h[o]*k],s=s.concat(g),p=[g[0]-c.corner*h[o]*j,g[1]-c.corner*i[o]*k],s=s.concat(p),0===o&&b.moveTo(s[0],s[1]),a.dashedBezier(b,s,d),q=[r[0]+c.corner*h[o]*j,r[1]+c.corner*i[o]*k]}else p=g,q=r;l===n[o]?(a.dashedLine(b,p,e,d),
a.dashedLine(b,e,m,d),a.dashedLine(b,m,f,d),a.dashedLine(b,f,q,d)):a.dashedLine(b,p,q,d),g=r}b.closePath()},s=function(b,c,d){var e=[c.x,c.y+c.h],f=[c.x+c.w,c.y+c.h],g=[c.x+c.ex.dx,c.y+c.ex.dy];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedLine(b,g,e,d)},t=function(b,c,d,e){var f=a.direction(b.x,b.y,b.w,b.h,c),g=[0,0],h=[0,0],i=function(a){var b=a/6,c=b+a/4,d=5*a/12;return[b,c,d]},j=null,k=f;switch(f===a.EAST||f===a.WEST?(j=i(b.h),g[1]=b.y+j[0],h[1]=b.y+j[1],(b.h>0&&c[1]>b.y+b.h/2||b.h<0&&c[1]<b.y+b.h/2)&&(g[1]+=j[2],h[1]+=j[2]),b.w<0&&(k=(a.WEST|a.EAST)^f)):(j=i(b.w),g[0]=b.x+j[0],h[0]=b.x+j[1],(b.w>0&&c[0]>b.x+b.w/2||b.w<0&&c[0]<b.x+b.w/2)&&(g[0]+=j[2],h[0]+=j[2]),b.h<0&&(k=(a.NORTH|a.SOUTH)^f)),k){case a.EAST:g[0]=b.x+b.w,h[0]=b.x+b.w;break;case a.NORTH:g[1]=b.y,h[1]=b.y;break;case a.WEST:g[0]=b.x,h[0]=b.x;break;case a.SOUTH:g[1]=b.y+b.h,h[1]=b.y+b.h}return d.call(e||this,g,h,f)},u=.6,v=.8,w=function(b,c,d,e,f,g){var h=[c,d],i=[c+e,d],j=[c+e,d+f*u],k=[c,d+f*v],l=x(c,d,e,f);b.moveTo(k[0],k[1]),a.dashedBezier(b,k.concat(l).concat(j),g),a.dashedLine(b,j,i,g),a.dashedLine(b,i,h,g),a.dashedLine(b,h,k,g)},x=function(a,b,c,d){return[a+c/4,b+d*(2-v),a+c/2,b+d*u]},y=function(b,c,d,e,f){var g=a.inRect(b,c,d,e,f),h=f[0],i=f[1];if(g&&i>c+e*u){var j=(h-b)/d,k=x(b,c,d,e),l=[b,c+e*v],m=[b+d,c+e*u],n=a.bezier(l.concat(k).concat(m),j);g=e>=0?i<=n[1]:i>=n[1]}return g},z=function(b,c,d,e,f,g){for(var h=.8*e,i=.8*f,j=d+f*v,k=c,l=0;3>l;l++){var m=c+l*e*.1,n=d+f*(.2-.1*l);b.moveTo(m,j),a.dashedLine(b,[m,j],[m,n],g),a.dashedLine(b,[m,n],[m+h,n],g),a.dashedLine(b,[m+h,n],[m+h,n+i*u],g);var o=[m+h,n+i*u],p=[k,n+i*u];if(0===l){var q=x(m,n,h,i);b.moveTo(k,j),a.dashedBezier(b,[k,j].concat(q).concat(o),g)}else a.dashedLine(b,o,p,g);j=n,k=m+h}},A=function(b,c,d,e,f){var g=a.inRect(b,c,d,e,f);if(g)for(var h=.8*d,i=.8*e,j=0;3>j;j++){var k=b+j*d*.1,l=c+e*(.2-.1*j);if(g=0===j?y(k,l,h,i,f):a.inRect(k,l,h,i*u,f))break}return g},B=function(b,c,d,e,f,g,h,i){var j=c+e/2,k=d+f/2,l=h[0],m=h[1],n=null;return g=g||1,1===(1&g)||2===(2&g)?(a.dashedLine(b,[l,m],[l,d],i),a.dashedLine(b,[l,d],[c,k],i),a.dashedLine(b,[c,k],[l,d+f],i),n=[l,2*k-m],a.dashedLine(b,[l,d+f],n,i),n):4===(4&g)||8===(8&g)?(a.dashedLine(b,[l,m],[c,m],i),a.dashedLine(b,[c,m],[j,d],i),a.dashedLine(b,[j,d],[c+e,m],i),n=[2*j-l,m],a.dashedLine(b,[c+e,m],n,i),n):void 0},C=function(b,c,d,e,f,g,h,i){var j=c+e/2,k=d+f/2,l=c+h[0],m=d+h[1];g=g||1;var n=null,o=null;1===(1&g)||4===(4&g)?(n=[l,m],o=B(b,c,d,e,f,g,[l,m],i)):2===(2&g)?(n=[c,m],o=[c,2*k-m],a.dashedLine(b,n,o,i)):8===(8&g)&&(n=[l,d],o=[2*j-l,d],a.dashedLine(b,n,o,i)),2===(2&g)||8===(8&g)?(a.dashedLine(b,o,[2*j-l,2*k-m],i),b.save(),b.translate(j,k),b.rotate(-Math.PI),o=B(b,c-j,d-k,e,f,g,[l-j,m-k],i),a.dashedLine(b,o,[j-n[0],k-n[1]],i),b.restore()):1===(1&g)?(a.dashedLine(b,o,[c+e,2*k-m],i),a.dashedLine(b,[c+e,2*k-m],[c+e,m],i),a.dashedLine(b,[c+e,m],[l,m],i)):4===(4&g)&&(a.dashedLine(b,o,[2*j-l,d+f],i),a.dashedLine(b,[2*j-l,d+f],[l,d+f],i),a.dashedLine(b,[l,d+f],[l,m],i)),b.closePath()},D=function(b,c,d,e,f,g,h){var i=b+d/2,j=c+e/2,k=b+g[0],l=c+g[1],m=!1,n=!1,o=null,p=null;return 1===(1&f)&&(m=a.inTriangle([k,c],[b,j],[k,c+e],h),o=[k,l],p=[b+d,2*j-l]),4===(4&f)&&(m=a.inTriangle([b,l],[i,c],[b+d,l],h),o=[k,l],p=[2*i-k,c+e]),2===(2&f)&&(n=a.inTriangle([2*i-k,c],[2*i-b,j],[2*i-k,c+e],h),p=[2*i-k,2*j-l],null==o&&(o=[b,l])),8===(8&f)&&(n=a.inTriangle([b,2*j-l],[i,c+e],[b+d,2*j-l],h),p=[2*i-k,2*j-l],null==o&&(o=[k,c])),m||n||a.inRect(o[0],o[1],p[0]-o[0],p[1]-o[1],h)},E=function(a,b,c,d,e,f){var g=a+c/2,h=b+d/2,i=a+f[0],j=b+f[1],k=[];return 1===(1&e)&&(k[k.length]=[i,b],k[k.length]=[i,b+d]),4===(4&e)&&(k[k.length]=[a+c,j],k[k.length]=[a,j]),2===(2&e)&&(k[k.length]=[2*g-i,b],k[k.length]=[2*g-i,b+d]),8===(8&e)&&(k[k.length]=[a,2*h-j],k[k.length]=[a+c,2*h-j]),(1===(1&e)||2===(2&e))&&(k[k.length]=[g,j],k[k.length]=[g,2*h-j],k[k.length]=[a,h],k[k.length]=[2*g-a,h]),(4===(4&e)||8===(8&e))&&(k[k.length]=[i,h],k[k.length]=[2*g-i,h],k[k.length]=[g,b],k[k.length]=[g,b+d]),k},F=function(b,c,d,e){var f=.5522848,g=5*c.w/6,h=2*c.w/3,j=g/2*f,k=c.ex[0],l=c.ex[1],m=c.ex[2],n=c.h*(e?1:0),o=c.h*(e?0:1),p=[c.x+2*(k.dx-g)-m.dx+h,c.y+n],q=[c.x+k.dx,c.y+n],r=[p[0]+(q[0]-p[0])/2,c.y+o],s=[c.x,c.y+n],t=[c.x+2*g-k.dx+m.dx-h,c.y+n],u=[s[0]+(t[0]-s[0])/2,c.y+o];b.moveTo(p[0],p[1]),a.dashedBezier(b,p.concat([r[0]-j,c.y+o]).concat(r),d),a.dashedLine(b,r,u,d),a.dashedBezier(b,u.concat([u[0]-j,c.y+o]).concat(s),d);var v=c.fillStyle||"#fff";b.fillStyle=i(v),b.closePath(),b.fill();var w=c.style;null==w&&(w=3),2===(2&w)&&b.stroke(),b.beginPath(),b.moveTo(r[0],r[1]);var x=r.concat([r[0]+j,c.y+o]).concat(q),y=a.bezier(x,Math.abs((o-l.dy)/c.h)),z=r.concat([r[0]+(y[0]-r[0])/2,c.y+o]).concat(y);a.dashedBezier(b,z,d);var A=t.concat([u[0]+j,c.y+o]).concat(u),B=a.bezier(A,Math.abs((n-l.dy)/c.h)),C=B.concat([u[0]+(B[0]-u[0])/2,c.y+o]).concat(u),D=c.w-k.dx,E=t[0]+(q[0]-t[0])/2,F=[y[0]+D,y[1]],G=[E,c.y+n],H=[B[0]-D,B[1]];a.dashedLine(b,z.slice(z.length-2),F,d),a.dashedLine(b,F,G,d),a.dashedLine(b,G,H,d),a.dashedLine(b,H,C.slice(0,2),d),a.dashedBezier(b,C,d)},G=function(b,c,d,e){var f=.5522848,g=5*c.h/6,h=2*c.h/3,j=g/2*f,k=c.ex[0],l=c.ex[1],m=c.ex[2],n=c.w*(e?1:0),o=c.w*(e?0:1),p=[c.x+n,c.y+2*(k.dy-g)-m.dy+h],q=[c.x+n,c.y+k.dy],r=[c.x+o,p[1]+(q[1]-p[1])/2],s=[c.x+n,c.y],t=[c.x+n,c.y+2*g-k.dy+m.dy-h],u=[c.x+o,s[1]+(t[1]-s[1])/2];b.moveTo(p[0],p[1]),a.dashedBezier(b,p.concat([c.x+o,r[1]-j]).concat(r),d),a.dashedLine(b,r,u,d),a.dashedBezier(b,u.concat([c.x+o,u[1]-j]).concat(s),d);var v=c.fillStyle||"#fff";b.fillStyle=i(v),b.closePath(),b.fill();var w=c.style;null==w&&(w=3),2===(2&w)&&b.stroke(),b.beginPath(),b.moveTo(r[0],r[1]);var x=r.concat([c.x+o,r[1]+j]).concat(q),y=a.bezier(x,Math.abs((o-l.dx)/c.w)),z=r.concat([c.x+o,r[1]+(y[1]-r[1])/2]).concat(y);a.dashedBezier(b,z,d);var A=t.concat([c.x+o,u[1]+j]).concat(u),B=a.bezier(A,Math.abs((n-l.dx)/c.w)),C=B.concat([c.x+o,u[1]+(B[1]-u[1])/2]).concat(u),D=c.h-k.dy,E=t[1]+(q[1]-t[1])/2,F=[y[0],y[1]+D],G=[c.x+n,E],H=[B[0],B[1]-D];a.dashedLine(b,z.slice(z.length-2),F,d),a.dashedLine(b,F,G,d),a.dashedLine(b,G,H,d),a.dashedLine(b,H,C.slice(0,2),d),a.dashedBezier(b,C,d)};a.reg({oval:{renderer:function(b,c,d){a.dashedOval(b,c,d)},isOver:function(a,b,c){return d(a,b,c)}},ovalx:{init:function(a){a.ex||(a.ex={dx:.1*a.w,dy:a.h+.3*a.h})},renderer:function(b,c,d){a.dashedOval(b,c,d)},isOver:function(a,b,c){return d(a,b,c)||!this.exFreeze(a,b,c)},exFreeze:function(b,c,d){var e=[d.x+d.ex.dx,d.y+d.ex.dy];return a.doOvalEx(d,e,function(d,f){return!a.inTriangle(d,f,e,[b,c])})}},line:{init:function(a){a.ex||(a.ex=[{dx:a.w/2,dy:a.h/2}],a.adjPoint=136,a.style=2)},renderer:function(a,b,c){l(a,b,c),m(a,b)},isOver:function(a,b,c){return o([a,b],c)},drawExPoint:function(a,b,c){a.save();var d=7,e=b.x+c.dx,f=b.y+c.dy;a.fillStyle="#000",a.strokeStyle="#fff",a.beginPath(),a.lineWidth=2,c.main?(a.fillRect(e-d/2,f-d/2,d,d),a.strokeRect(e-d/2,f-d/2,d,d)):(d=3,a.arc(e,f,d,0,2*Math.PI,!1)),a.closePath(),a.fill(),a.stroke(),a.restore()},exFreeze:function(b,c,d,e){return e===a.ACT_RESIZE},onActionStart:function(b,c,d){var e=[];if(b===a.ACT_EX_MOVE&&d.exInd>=0){var f=c.ex[d.exInd],g=d.exInd-1,h=d.exInd+1;null!=f&&f.main&&(g>0&&(e=e.concat(c.ex.slice(0,g))),e.push(f),h+1<c.ex.length&&(e=e.concat(c.ex.slice(h+1,c.ex.length))),f.main=!1,c.ex=e,d.exInd=g)}else{for(var i=0;i<c.ex.length;i++)c.ex[i].main&&(e[e.length]=c.ex[i]);c.ex=e}},onActionDone:function(b,c,d){var e=[];if(b===a.ACT_EX_MOVE&&d.exInd>=0){var f=c.ex[d.exInd];if(null==f)return;var g=d.exInd-1,h=d.exInd+1,i=null,j=null;if(f.main)return g=d.exInd-2,h=d.exInd+2,i=0>g?[0,0]:[c.ex[g].dx,c.ex[g].dy],j=h>=c.ex.length?[c.w,c.h]:[c.ex[h].dx,c.ex[h].dy],c.ex[g+1]={dx:f.dx-(f.dx-i[0])/2,dy:f.dy-(f.dy-i[1])/2},void(c.ex[h-1]={dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2});f.main=!0,0>g?i=[0,0]:(i=[c.ex[g].dx,c.ex[g].dy],e=e.concat(c.ex.slice(0,d.exInd))),e.push({dx:f.dx-(f.dx-i[0])/2,dy:f.dy-(f.dy-i[1])/2}),e.push(f),h>=c.ex.length?(j=[c.w,c.h],e.push({dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2})):(j=[c.ex[h].dx,c.ex[h].dy],e.push({dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2}),e=e.concat(c.ex.slice(h,c.ex.length))),c.ex=e}else{var k={dx:0,dy:0},l=0,m=0;if(a.isArray(c.ex))for(var n=0;n<c.ex.length;n++)c.ex[n].main&&(l=(c.ex[n].dx-k.dx)/2,m=(c.ex[n].dy-k.dy)/2,e[e.length]={dx:c.ex[n].dx-l,dy:c.ex[n].dy-m},e[e.length]=c.ex[n],k=c.ex[n]);l=(c.w-k.dx)/2,m=(c.h-k.dy)/2,e[e.length]={dx:c.w-l,dy:c.h-m},c.ex=e}}},linex:{init:function(a){a.ex||(a.ex={dx:3*a.w/4,dy:a.h/4},a.style=2)},renderer:function(b,c,d){c.ex?(b.moveTo(c.x,c.y),a.dashedBezier(b,[c.x,c.y,c.x+c.ex.dx,c.y+c.ex.dy,c.x+c.w,c.y+c.h],d)):a.dashedLine(b,[c.x,c.y],[c.x+c.w,c.y+c.h],d),m(b,c)},isOver:function(a,b,c){return e(c.x,c.y,c.x+c.ex.dx,c.y+c.ex.dy,c.x+c.w,c.y+c.h,a,b)}},linexx:{init:function(a){a.ex||(a.ex=[{dx:a.w,dy:0},{dx:0,dy:a.h}],a.style=2)},renderer:function(b,c,d){c.ex?(b.moveTo(c.x,c.y),a.dashedBezier(b,[c.x,c.y,c.x+c.ex[0].dx,c.y+c.ex[0].dy,c.x+c.ex[1].dx,c.y+c.ex[1].dy,c.x+c.w,c.y+c.h],d)):a.dashedLine(b,[c.x,c.y],[c.x+c.w,c.y+c.h],d),m(b,c)},isOver:function(a,b,c){return f(c.x,c.y,c.x+c.ex[0].dx,c.y+c.ex[0].dy,c.x+c.ex[1].dx,c.y+c.ex[1].dy,c.x+c.w,c.y+c.h,a,b)}},rect:{renderer:function(a,b,c){r(a,b,c)}},rectx:{init:function(a){a.ex||(a.ex={dx:.1*a.w,dy:a.h+.3*a.h})},renderer:function(a,b,c){r(a,b,c)},isOver:function(b,c,d){return a.inRect(d.x,d.y,d.w,d.h,[b,c])||this.isExOver(b,c,d)},isExOver:function(b,c,d){var e=[d.x+d.ex.dx,d.y+d.ex.dy];return t(d,e,function(d,f){return a.inTriangle(d,f,e,[b,c])})}},doc:{renderer:function(a,b,c){w(a,b.x,b.y,b.w,b.h,c)},isOver:function(a,b,c){return y(c.x,c.y,c.w,c.h,[a,b])}},docs:{renderer:function(a,b,c){z(a,b.x,b.y,b.w,b.h,c)},isOver:function(a,b,c){return A(c.x,c.y,c.w,c.h,[a,b])}},arrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5}),a.arrow=a.arrow||3},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,b.arrow,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,c.arrow,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,a.arrow,[a.ex.dx,a.ex.dy])}},larrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){var d=0,e=0;d=b.ex.dx,e=b.ex.dy,C(a,b.x,b.y,b.w,b.h,1,[d,e],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,1,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,1,[a.ex.dx,a.ex.dy])}},rarrow:{init:function(a){a.ex||(a.ex={dx:a.w-a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,2,[b.w-b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,2,[c.w-c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,2,[a.w-a.ex.dx,a.ex.dy])}},lrarrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,3,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,3,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,3,[a.ex.dx,a.ex.dy])}},uarrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,4,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,4,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,4,[a.ex.dx,a.ex.dy])}},darrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h-a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,8,[b.ex.dx,b.h-b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,8,[c.ex.dx,c.h-c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,8,[a.ex.dx,a.h-a.ex.dy])}},udarrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,12,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,12,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,12,[a.ex.dx,a.ex.dy])}},triangle:{init:function(a){a.ex||(a.ex={dx:a.w/2,dy:0})},renderer:function(a,b,c){s(a,b,c)},isOver:function(b,c,d){var e=[d.x,d.y+d.h],f=[d.x+d.w,d.y+d.h],g=[d.x+d.ex.dx,d.y+d.ex.dy];return a.inTriangle(e,f,g,[b,c])}},cube:{init:function(a){a.ex||(a.ex={dx:3*a.w/4,dy:1*a.h/4})},renderer:function(a,b,c){p(a,b,c)}},stick:{init:function(a){a.ex||(a.ex={dx:a.w/2,dy:a.h/2})},renderer:function(a,b,c){q(a,b,c)}},downArcArrow:{init:function(a){a.ex||(a.ex=[{dx:11*a.w/12,dy:-10},{dx:a.w+10,dy:a.h/5},{dx:2*a.w/3,dy:-10}])},renderer:function(a,b,c){F(a,b,c)}},upArcArrow:{init:function(a){a.ex||(a.ex=[{dx:11*a.w/12,dy:a.h+10},{dx:a.w+10,dy:4*a.h/5},{dx:2*a.w/3,dy:a.h+10}])},renderer:function(a,b,c){F(a,b,c,!0)}},rightArcArrow:{init:function(a){a.ex||(a.ex=[{dy:11*a.h/12,dx:-10},{dy:a.h+10,dx:a.w/5},{dy:2*a.h/3,dx:-10}])},renderer:function(a,b,c){G(a,b,c)}},leftArcArrow:{init:function(a){a.ex||(a.ex=[{dy:11*a.h/12,dx:a.w+10},{dy:a.h+10,dx:4*a.w/5},{dy:2*a.h/3,dx:a.w+10}])},renderer:function(a,b,c){G(a,b,c,!0)}}})}(window.jh2d=window.jh2d||{}),function(a,b,c){a.dashedLine=function(a,b,c,d){if(d){var e=this.delta(b,c),f=Math.sqrt(e[0]*e[0]+e[1]*e[1]),g=0,h=0;for(a.moveTo(b[0],b[1]);;){if(h+=d[g%d.length],h>=f)break;var i=e[0]/f*h,j=e[1]/f*h;g%2===0?a.lineTo(b[0]+i,b[1]+j):a.moveTo(b[0]+i,b[1]+j),g++}g%2===0?a.lineTo(c[0],c[1]):a.moveTo(c[0],c[1])}else a.lineTo(c[0],c[1])},a.dashedRect=function(b,c,d,e,f,g){g?(a.dashedLine(b,[c,d],[c+e,d],g),a.dashedLine(b,[c+e,d],[c+e,d+f],g),a.dashedLine(b,[c+e,d+f],[c,d+f],g),a.dashedLine(b,[c,d+f],[c,d],g),b.stroke()):b.strokeRect(c,d,e,f)}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b){return[b[0]-a[0],b[1]-a[1]]},e=function(a,b){var c=d(a,b);return Math.sqrt(c[0]*c[0]+c[1]*c[1])},f=function(a,b){var c=2;a.length>=8&&(c=3);var d,e,f=0,g=a[f++],h=a[f++],i=a[f++],j=a[f++],k=a[f++],l=a[f++];3===c&&(d=a[f++],e=a[f++]);var m=[];return 3===c?(m[m.length]=Math.pow(1-b,3)*g+3*b*Math.pow(1-b,2)*i+3*Math.pow(b,2)*(1-b)*k+Math.pow(b,3)*d,m[m.length]=Math.pow(1-b,3)*h+3*b*Math.pow(1-b,2)*j+3*Math.pow(b,2)*(1-b)*l+Math.pow(b,3)*e):(m[m.length]=Math.pow(1-b,2)*g+2*b*(1-b)*i+Math.pow(b,2)*k,m[m.length]=Math.pow(1-b,2)*h+2*b*(1-b)*j+Math.pow(b,2)*l),m},g=function(a,b){for(var c=.001,d=[],g=f(a,0),h=g,i=0,j=0,k=[],l=c;1>=l;l+=c){g=f(a,l);var m=e(h,g);m<b[i]/10||(j+=m,h=g,j>=b[i]&&(i%2===0&&d.push(k),i=(i+1)%b.length,k=[],j=0),i%2===0&&k.push(g[0],g[1]))}return k.length>0&&d.push(k),d},h=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.length>0&&a.moveTo(d[0],d[1]);for(var e=1;e<d.length/2;e++)a.lineTo(d[2*e],d[2*e+1])}};a.bezier=f,a.dashedBezier=function(a,b,c){if(c){var d=g(b,c);h(a,d)}else{var e=2;6===b.length&&a.quadraticCurveTo(b[e++],b[e++],b[e++],b[e++]),b.length>=8&&a.bezierCurveTo(b[e++],b[e++],b[e++],b[e++],b[e++],b[e++])}}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b,c,d){var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;return[a,k,a,k-g,j-f,b,j,b,j+f,b,h,k-g,h,k,h,k+g,j+f,i,j,i,j-f,i,a,k+g,a,k]},e=function(a,b){var c=6*b;return a.slice(c,c+8)},f=function(a,b,c){var d=c.w/2,e=c.h/2,f=a-c.x-d,g=b-c.y-e;return Math.pow(f/d,2)+Math.pow(g/e,2)<=1},g=function(b,c,d,e){var f=b.x,g=b.y,h=b.w,i=b.h,j=a.direction(f,g,h,i,c),k=Math.min(h,i),l=[],m=[],n=h/2,o=i/2,p=1;return j===a.NORTH||j===a.SOUTH?(p=h===k?4:6,l[0]=f+n-h/p,l[1]=g+o,m[0]=f+n+h/p,m[1]=g+o):(p=i===k?4:6,l[0]=f+n,l[1]=g+o-i/p,m[0]=f+n,m[1]=g+o+i/p),d.call(e||this,l,m,j)};a.inOval=f,a.doOvalEx=g,a.calcOvalGap=function(b,c,f,h){var i=[],j=[],k=b.w/2,l=0;g(b,c,function(a,c,d){i=a,j=c,l=d,b.w<0&&(l===this.EAST||l===this.WEST)&&(l^=this.EAST|this.WEST),b.h<0&&(l===this.NORTH||l===this.SOUTH)&&(l^=this.NORTH|this.SOUTH)},this);var m=[(c[1]-i[1])/(c[0]-i[0]),(c[1]-j[1])/(c[0]-j[0])],n=d(b.x,b.y,b.w,b.h),o=[];switch(l){case this.EAST:o=[e(n,1),e(n,2)];break;case this.NORTH:o=[e(n,0),e(n,1)];break;case this.WEST:o=[e(n,3),e(n,0)],m=m.reverse();break;case this.SOUTH:o=[e(n,2),e(n,3)],m=m.reverse()}for(var p=0,q=Math.abs(1/k),r=[],s=0;s<o.length;s++)for(var t=o[s],u=0,v=0;1>=v;v+=q){var w=a.bezier(t,v),x=m[p]*(w[0]-c[0])+c[1],y=w[1]-x>0?1:2;if(x===w[1]||0!==u&&u!==y){if(r[r.length]=w,1===p)break;p++,u=0}else u=y}f.call(h||this,r,n,l)},a.dashedOval=function(b,c,g,h){var i=c.ex,j=!1;if(i&&!f(c.x+c.ex.dx,c.y+c.ex.dy,c)){var k=a.center(c.x,c.y,c.w,c.h),l=[c.x+c.ex.dx,c.y+c.ex.dy];a.calcOvalGap(c,l,function(d,f,h){if(j=2!==d.length,!j){var i,m,n=0;switch(h){case this.SOUTH:n=0,c.w>0?(i=d[0][0]>k[0],m=d[1][0]>k[0]):(i=d[0][0]<k[0],m=d[1][0]<k[0]);break;case this.NORTH:n=2,c.w>0?(i=d[0][0]<k[0],m=d[1][0]<k[0]):(i=d[0][0]>k[0],m=d[1][0]>k[0]);break;case this.WEST:n=1,c.h>0?(i=d[0][1]>k[1],m=d[1][1]>k[1]):(i=d[0][1]<k[1],m=d[1][1]<k[1]);break;case this.EAST:n=3,c.h>0?(i=d[0][1]<k[1],m=d[1][1]<k[1]):(i=d[0][1]>k[1],m=d[1][1]>k[1])}var o=e(f,n++);g||b.moveTo(o[0],o[1]),a.dashedBezier(b,o,g),a.dashedBezier(b,e(f,n++%4),g),i?(o=e(f,n%4),o=o.slice(0,4).concat(d[0]),a.dashedBezier(b,o,g),a.dashedLine(b,d[0],l,g),a.dashedLine(b,l,d[1],g),m||n++):(a.dashedBezier(b,e(f,n++%4),g),o=e(f,n%4),o=o.slice(0,4).concat(d[0]),a.dashedBezier(b,o,g),a.dashedLine(b,d[0],l,g),a.dashedLine(b,l,d[1],g)),m?(o=e(f,n++%4),o=d[1].concat(o.slice(4)),a.dashedBezier(b,o,g),a.dashedBezier(b,e(f,n%4),g)):(o=e(f,n%4),o=d[1].concat(o.slice(2)),a.dashedBezier(b,o,g))}})}else h=h||[1,1,1,1];if(h){var m=d(c.x,c.y,c.w,c.h);b.moveTo(m[0],m[1]);for(var n=0;n<h.length;n++){var o=e(m,n);h[n]?a.dashedBezier(b,o,g):b.moveTo(o[o.length-2],o[o.length-1])}return m}}}(window.jh2d=window.jh2d||{});/*! bootstrap-jh2d-editor 2015-05-18 */
$(document).ready(function(){function a(a){if("undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var b=document.createRange();b.selectNodeContents(a),b.collapse(!1);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}else if("undefined"!=typeof document.body.createTextRange){var d=document.body.createTextRange();d.moveToElementText(a),d.collapse(!1),d.select()}}$('[data-toggle="tooltip"]').tooltip();for(var b=document.getElementById("canvas1"),c=uuid.noConflict(),d=[{title:"untitled",data:{sprites:[{type:"larrow",x:280,y:200,w:100,h:60,text:"Hang",textOpt:{color:"#f00"}},{type:"line",x:100,y:100,w:100,h:60,conn:1},{type:"line",x:100,y:300,w:100,h:60,conn:1},{type:"ovalx",x:200,y:300,w:80,h:40,fillStyle:"#14A2D4",shadow:9,gradient:3,text:"hg",textOpt:{font:"Times",size:"80"},style:3}]}},{title:"untitled1",data:{sprites:[{type:"larrow",x:280,y:300,w:100,h:60,text:"Hang",textOpt:{color:"#f00"}}]}}],e=function(a){return $('<li data-file-uuid="'+a.uuid+'"><a href="#"><button class="close closeTab" type="button" ><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'+a.title+'<i class="gb-unsaved"></i></a></li>').insertBefore($("#tab_files li").last())},f=0;f<d.length;f++){var g=d[f],h=c.v1();g.uuid=h,e(g)}$("#tab_files a:first").tab("show");var i=jh2d.instance(b,{background:1}).add(d[0].data.sprites).moveUp(2).show(),j=function(a){var b=k(a),c=null;return-1!==b&&(c=d[b]),c},k=function(a){for(var b=0;b<d.length;b++){var c=d[b];if(c.uuid===a)return b}return-1},l=function(){return $("#tab_files > li.active").data("file-uuid")},m=function(a){var b=j(a||l());return null!=b&&(b.data.sprites=i.data,b.data.options=i.options,$(".gb-unsaved",$("#tab_files > li.active")).text("*")),b},n=function(a){m();var b=j(a);i.setData(b.data.sprites,b.data.options),i.update()},o=function(a){var b=a.data("file-uuid");delete A[b],d.splice(k(b),1);var c=a.next();0===c.length&&(c=a.prev()),c.length>0&&(a.remove(),n(c.eq(0).data("file-uuid")),c.tab("show"))},p=!1,q=!1;$("body").on("dblclick",".btn-group button, .btn-group a",function(){p=!0}),$("body").on("click",".btn-group button, .btn-group a",function(){$(this).addClass("active"),$(this).siblings().removeClass("active");var a=$(this).data("gb-act-type"),c=$(this).data("gb-act-do");if(c)if(p)p=!1,s=null;else switch(a){case"shape":"text"!==c?i.newMode({type:c,fillStyle:"#fff"}):(q=!0,i.options.disabled=!0,b.style.cursor="text");break;case"zoom":var d=i.getScale();i.zoom(d+parseFloat(c));break;case"file":r(c);break;case"edit":t(c)}}),$("body").on("click",".closeTab",function(a){a.stopPropagation(),o($(this).parent().parent())}),$("body").on("click","#tab_files > a",function(a){a.preventDefault();var b=$(this).parent().data("file-uuid");-1!==b?(n(b),$(this).tab("show")):r("new")});var r=function(a){switch(a){case"new":var f={title:"Untitled"+(d.length+1)+"*",data:{sprites:[]}};d[d.length]=f;var g=c.v1();f.uuid=g,n(g);var h=$("#tab_files > li");e(f),$("#tab_files > a:eq("+(h.length-1)+")").tab("show");break;case"export":var i=b.toDataURL("image/png");window.open(i)}},s=null,t=function(a){switch(a){case"brush":-1!==v&&(s=jh2d.extend({},i.getSprite(v),!0,function(a){return!this.inArray(["style","fillStyle","gradient","shadow"],a)}));break;case"undo":E();break;case"repeat":F()}};$("body").on("mousedown","[class*='gb-ic-x']",function(a){var b=$(this).data("gb-act-do");b&&i.newMode({type:b,w:80,h:80,fillStyle:"#fff"},jh2d.ACT_NEW_DROP),a.preventDefault()});var u=!1;$("body").on("mouseup","#canvas1",function(){$(".btn-group button").removeClass("active"),u&&(m(),u=!1)}),$("body").on("mousemove","#canvas1",function(){var a=i.mDownFlag;a&&(u||-1===i.options.curIndex||(u=!0,D()))});var v=-1,w=!1;$("#canvas1").on("contextmenu",function(a){v=x(a.originalEvent);var b=$("#contextMenu");return-1!==v?($(".dropdown-submenu",b).addClass("disabled"),b.css({display:"block",left:a.pageX,top:a.pageY}),i.getSelectedCount()>1&&$(".dropdown-submenu",b).removeClass("disabled")):b.hide(),!1}),$("body").on("click","#canvas1",function(a){var c=$(this);$(".dropdown").hide();var d=i.getScale(),e=c.offset(),f=x(a.originalEvent),g=null;if(-1!==f){g=i.getSprite(f),s&&(D(),jh2d.extend(g,s,!0),i.update(),m());var h=$("#propPane");h.css({display:"block",left:e.left+(g.x+g.w)*d+10,top:e.top+g.y*d});var j=$('a[data-ssdlg-tabid="tab_image"]',h);g.img?(j.removeClass("hidden"),j.addClass("show")):(j.removeClass("show"),j.addClass("hidden"))}else $("#propPane").hide();var k=$("#textEdit");if(q){var l=k.html(),n=a.originalEvent,o=n.offsetX||n.layerX,r=n.offsetY||n.layerY;if(null!=l&&""!==l){if(q=!1,w){D();var t=k.offset();g={type:"rect",x:t.left-e.left,y:t.top-e.top+4,w:k.width(),h:k.height(),text:l,style:0,textOpt:{align:6}},i.add(g),i.options.disabled=!1,i.update(),m()}w=!1,k.hide()}else k.removeAttr("style"),k.css({display:"block",left:e.left+o,top:e.top+r,minHeight:24}).focus().text(""),w=!0,b.style.cursor="default"}else-1!==v&&w&&(D(),g=i.getSprite(v),g.text=k.html(),0===g.style&&jh2d.extend(g,{w:k.width(),h:k.height()},!0),i.update(),m(),k.text("").hide()),w=!1;return p||(s=null),v=f,!1});var x=function(a){var b=a.offsetX||a.layerX,c=a.offsetY||a.layerY,d=i.getScale();return b/=d,c/=d,i.indexOf(b,c)};$("body").on("dblclick","#canvas1",function(b){var c=$(this),d=i.getScale(),e=c.offset();if(v=x(b.originalEvent),-1!==v){var f=i.getSprite(v),g=e.left+f.x+f.w/4,h=e.top+f.y+f.h/4,j=jh2d.DEF_TEXT_OPT,k=12,l=f.w;if(f.text){j=f.textOpt,k=j.h.height,l=j.w.width;var m=j.x,n=j.y,o=j.align;m-=j.w.width/2,n-=k/2,(o&jh2d.EAST)===jh2d.EAST?m=j.x-j.w.width:(o&jh2d.WEST)===jh2d.WEST?m=j.x:(o&jh2d.SOUTH)===jh2d.SOUTH?n=j.y-k:(o&jh2d.NORTH)===jh2d.NORTH&&(n=j.y),g=e.left+m*d,h=e.top+n*d}var p=$("#textEdit");p.css({display:"block",left:g,top:h+4,minWidth:Math.max(f.w,l)*d,minHeight:f.h/2*d,fontFamily:j.font,fontStyle:j.style,fontWeight:j.weight,fontSize:j.size+"px",color:j.color,backgroundColor:"#fff",lineHeight:k+"px"}).focus().html(f.text||""),w=!0,a(p[0])}}),$("body").on("click","#contextMenu .dropdown-menu a",function(){$(".dropdown").hide();var a=$(this).data("gb-act-do");switch(D(),a){case"up":i.moveUp(v);break;case"down":i.moveDown(v);break;case"top":i.moveTop(v);break;case"bottom":i.moveBottom(v);break;case"grp":i.group();break;case"ungrp":i.ungroup();break;case"align-right":i.align(1);break;case"align-top":i.align(2);break;case"align-left":i.align(4);break;case"align-bottom":i.align(8);break;case"align-vcenter":i.align(5);break;case"align-hcenter":i.align(10)}i.update(),m()}),$("#textEdit").on("keydown",function(a){a.stopPropagation()});var y=null,z=0;$(document).bind("keydown","del backspace Ctrl+a Ctrl+c Ctrl+v Ctrl+n Ctrl+w Ctrl+z Ctrl+y",function(a){if(a.ctrlKey)switch(String.fromCharCode(a.which).toLowerCase()){case"a":i.selectAll().update();break;case"c":var b=i.getSelecteds();b.length>0&&(y=b);break;case"v":if(null!=y){for(var c=jh2d.clone(y),d=0;d<c.length;d++){var e=c[d];e.x+=10*(1+z),e.y+=10*(1+z)}D(),i.add(c).update(),z++,m()}break;case"n":r("new");break;case"w":o($("#tab_files > li.active"));break;case"z":E();break;case"y":F()}else switch(jQuery.hotkeys.specialKeys[a.which]){case"del":case"backspace":D(),i.removeSelected()&&i.update(),m()}return!1}).keydown(function(a){switch(jQuery.hotkeys.specialKeys[a.keyCode]){case"ctrl":i.setMultiSelect(!0)}}).keyup(function(a){switch(jQuery.hotkeys.specialKeys[a.keyCode]){case"ctrl":i.setMultiSelect(!1)}});var A={},B=10,C=0,D=function(){var a=l();A[a]||(A[a]=[]);var b={data:{sprites:jh2d.clone(i.data),options:jh2d.clone(i.options)}};C>0?(A[a].splice(A[a].length-C,C,b),C=0):(A[a].length>=B&&A[a].shift(),A[a].push(b))},E=function(){var a=l(),b=A[a],c=b[b.length-1-C];C<b.length&&(i.setData(c.data.sprites,c.data.options),i.update(),C++)},F=function(){if(C>0){var a=l();C--;var b=null;b=0!==C?A[a][A[a].length-C]:j(a),i.setData(b.data.sprites,b.data.options),i.update()}},G=$("#shapestyle-dialog");G.shapeStyleDialog(),G.on("optionChange",function(a){if(-1!==v){var b=i.getSprite(v),c=null;switch(console.log(a.key+":"+a.val),D(),a.key){case"r":b.rotate=a.val*Math.PI/180;break;case"gradient":var d=parseInt(a.val/4),e=a.val%4;switch(b.gradientType=0,b.gradientCnt=2,d){case 0:b.gradient=1;break;case 1:b.gradient=2;break;case 2:b.gradient=3;break;case 3:b.gradient=6;break;case 4:b.gradientType=1,b.gradient=15;break;case 5:b.gradientType=1,b.gradient=2>e?3:6}e%2!==0&&(b.gradient*=-1),5!==d&&e>1&&(b.gradientCnt=3),b.fillStyle=b.fillStyle||"#eee",b.style|=1;break;case"strokeSize":c=b.style||3,0===a.val?c&=-3:c|=2,b.style=c,b[a.key]=a.val;break;case"strokeStyle":if(c=b.style||3,null==a.val)c&=-3;else{b[a.key]=a.val;var f=$(a.target).shapeStyleDialog("option");f.strokeSize&&(c|=2,b.strokeSize=f.strokeSize)}b.style=c;break;case"fillStyle":c=b.style||3,null==a.val?c&=-2:c|=1,b.style=c,b[a.key]=a.val;break;case"alpha":b[a.key]=a.val/100;break;case"img":b[a.key]=a.val;break;case"shadow":8===a.val?b.shadowOffset=0:b.shadowOffset=5,b.shadowAngle=a.val*Math.PI/4;break;default:if(0===a.key.indexOf("font-")){var g=a.key.substring(5);b.textOpt=b.textOpt||{},b.textOpt[g]=a.val}else b[a.key]=a.val}console.log(b),i.update(),m()}}),G.on("imgload",function(a){var b=a.relatedTarget;jh2d.resource_cache[b.src]=b}),G.on("show.bs.modal",function(){if(-1!==v){var a=i.getSprite(v),b=$.extend({r:0,fillStyle:"#fff",strokeStyle:"#000"},a),c=null;for(c in b)switch(c){case"alpha":b.alpha*=100;break;case"rotate":b.r=Math.round(180*b.rotate/Math.PI);break;case"img":var d={};d.url=b.img.url,d.rect={x:b.img.x,y:b.img.y,w:b.img.w,h:b.img.h},b.img=d;break;case"shadowAngle":b.shadow=Math.round(4*b[c]/Math.PI);break;case"style":0===(1&b[c])&&(b.fillStyle=null)}if(b.textOpt){b.textOpt.decoration=b.textOpt.decoration||"";for(c in b.textOpt)b["font-"+c]=b.textOpt[c];delete b.textOpt}$(this).shapeStyleDialog("option",b)}}),G.on("shown.bs.modal",function(a){var b=$(a.relatedTarget),c=b.data("ssdlg-tabid"),d=$('.nav-tabs a[href="#'+c+'"]',$(this));"tab_image"===c&&d.parent().is(".active")?$(this).shapeStyleDialog("imgpickerUpdate"):d.tab("show")})});